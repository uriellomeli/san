---
title: "Economic Hardships During the COVID-19 Pandemic Require Targeted Recovery Assistance"
subtitle: "Findings from San Antonio Community Survey"
date: "`r format(Sys.time(), '%d %B, %Y')`"
author: 
- Ying Huang, Ph.D.^[University of Texas at San Antonio, ying.huang@utsa.edu]
- Uriel Lomelí, M.Sc.^[University of Texas at San Antonio, uriel.lomelcarrillo@utsa.edu]
- Renhao Sun^[University of Texas at San Antonio, renhao.sun@my.utsa.edu]
- Marla Gutierrez^[University of Texas at San Antonio, marlagutz09@gmail.com]
- Joel Sanchez^[University of Texas at San Antonio, bbrjs1112@yahoo.com]
- Eric Shattuck, Ph.D.^[University of Texas at San Antonio, eric.shattuck@utsa.edu]
- Wenbo Wu, Ph.D.^[University of Texas at San Antonio, wenbo.wu@utsa.edu]
output: 
  html_document:
    toc: true
    toc_float: true
    code_folding: hide
    highlight: tango
---

<style>
body {
text-align: justify}
</style>

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r libs, message=FALSE, include=FALSE}
library(ggplot2)
library(ggrepel)
library(dplyr)
library(ggsci)
library(wesanderson)
library(stringr)
library(moe)
library(patchwork)
```

```{r load, include=FALSE}
load(file = "~/GitHub/saetus/data_recode.RData")

data <- data %>% 
  mutate_at(vars(hardships_1:hardships_6), funs(recode(., "Yes" = as.numeric(1), "No" = as.numeric(0)))) %>% 
  mutate(hards = hardships_1 + hardships_2 + hardships_3 + hardships_4 + hardships_5 + hardships_6, 
         race_eth2 = case_when(race_eth %in% "NH-White" ~ "Non-Hispanic White",
                               race_eth %in% "Hispanic" ~ "Hispanic",
                               race_eth %in% "NH-Black" ~ "Non-Hispanic Black",
                               race_eth %in% "NH-Asian" ~ "Non-Hispanic Asian",
                               race_eth %in% c("NH-AIAN", "NH-NHPI", "NH-Other") ~ "Non-Hispanic Other"),
         race_eth3 = case_when(race_eth %in% "NH-White" ~ "Non-Hispanic White",
                               race_eth %in% "Hispanic" ~ "Hispanic",
                               race_eth %in% c("NH-Black", "NH-Asian", "NH-AIAN", "NH-NHPI", "NH-Other") ~ "Non-Hispanic Other"),
         bad = if_else(hards == 1, "One hardship", 
                       if_else(hards == 2, "Two hardships",
                               if_else(hards > 2, "More than two", NA_character_))))

data$bad <- ordered(data$bad, levels = c("One hardship", "Two hardships", "More than two"))
data$race_eth <- ordered(data$race_eth, levels = c("Hispanic", "NH-White", "NH-Black", "NH-Asian", "NH-AIAN", "NH-NHPI", "NH-Other"))
data$race_eth2 <- ordered(data$race_eth2, 
                          levels = c("Hispanic", "Non-Hispanic White", "Non-Hispanic Black", "Non-Hispanic Asian","Non-Hispanic Other"))
data$race_eth3 <- ordered(data$race_eth3, levels = c("Hispanic", "Non-Hispanic White", "Non-Hispanic Other"))
data$health <- ordered(data$health, levels = c("Excellent", "Very good", "Good", "Fair", "Poor"))
```

```{r themeu, include=FALSE, message=FALSE, warning=FALSE}
sysfonts::font_add_google(name = 'Lato', family = "foo")
showtext::showtext_auto()

themeu <- theme(legend.position = "bottom", 
                legend.text = element_text(size = 15, color = "gray40"), 
                legend.key.size = unit(.5, "cm"),
                panel.background = element_rect(colour = "black"),
                plot.title = element_text(face = "bold", size = 30, hjust = .5, vjust = .5, lineheight = .5), 
                plot.caption = element_text(size = 15),
                plot.subtitle = element_text(colour = "gray50", face = "bold", size = 22, lineheight = .5, hjust = .5, vjust = .5),
                axis.text = element_text(size = 20), 
                text = element_text(family = "foo"))

themeuf <- theme(legend.position = "top", 
                 legend.text = element_text(size = 25, color = "gray30"), 
                 legend.key.size = grid::unit(.5, "cm"), 
                 legend.title = element_text(color = "gray25", face = "bold", size = 20), 
                 panel.background = element_rect(colour = "black"),
                 plot.title = element_text(face = "bold", size = 32, hjust = .5, vjust = .5, lineheight = .5), 
                 plot.caption = element_text(size = 19),
                 plot.subtitle = element_text(colour = "gray30", face = "bold", size = 26, lineheight = .5, hjust = .5, vjust = .5),
                 axis.text = element_text(size = 27, color = "gray10", face = "bold"),
                 strip.text = element_text(size = 25), 
                 axis.title.x = element_text(color = "gray10", size = 25), 
                 axis.ticks.y = element_blank(),
                 panel.grid.major.x = element_blank(),
                 panel.grid.minor.x = element_blank(),
                 panel.grid.major.y = element_line(colour = "grey70", linetype = "dotted"),
                 plot.tag = element_text(size = 30),
                 text = element_text(family = "foo"))
```

<br>
Ever since San Antonio confirmed its first COVID-19 case more than one year ago , the COVID-19 pandemic and the associated social and economic fallouts have upended the lives of many. Although vaccine rollouts offer hopes for a rapid economic recovery, unemployment and other types of economic hardships persist, and many people are at risk of long-term economic distress. At the national level, unemployment rate continues to be higher than before the COVID-19 pandemic  and many households report that their households lack sufficient food to eat or are unable to make rental, medical, or utility bill payments.  At the local level, these economic hardships are likely to be distributed and shaped by the unequal ecological structures of local communities. Low-income and minority communities are disproportionately suffering from the COVID-19 pandemic and its related hardships. Black and Latino households were more than twice as likely as their White counterparts to report insufficient food (16% each, compared to 6% of White households). Additionally, the number of struggling families has increased dramatically, with a disproportionate impact on Latino and Black communities . The Household Pulse Survey show that 29% of Latino and 31% of Black households with children experienced three or more economic and health-related hardships as a result of the pandemic. This is almost twice the share among Asian (13%) and White (16%) households with children . Lastly, about 115 million people had experienced a loss of employment income from March 2020 to February 2021.  In this policy brief, we use household survey data in two selected local communities to assess how household economic hardships distribute across different communities. We also explore the unequal impacts of COVID-19 crisis on economic hardships across racial and ethnic groups. 
The key findings of this policy brief are 1) job loss, followed by paying rent, affording food, and delaying medical care were the most experienced hardships, and 2) while job loss varies little by neighborhood, racial inequalities prevail regardless. The challenge before us now is to create the conditions that make economic security possible for all. Recover from COVID-19 crisis is not only about controlling the spread of a virus, improving the economy, and getting people vaccinated; it is also about ensuring that the individuals and communities that have suffered the most can recover from this pandemic and be more resilient in the future. Low-income and minority communities also need targeted outreach and assistance implementing recovery measures. The design and implementation of the recovery measures will be a reflection of our humanity.

<h1>Data</h1>
<br>
Our analysis of the COVID-19 economic crisis in local communities is based on the San Antonio Energy and Time Use Survey. This is an online survey conducted between March 22-24, 2021 in Elm Creek (78230) and Jefferson Heights (78202). The household-level questionnaire collected information on time use, energy consumption, self-reported health and medical devices at home, employment situation, hardships experienced, and demographic characteristics. The study was approved by the University of Texas at San Antonio Institutional Review Board.
We selected Elm Creek and Jefferson Heights as our study sites because they represent different socioeconomic and demographic contexts (Table 1). The Elm Creek neighborhood (78230) is located in North central of San Antonio, Texas, and the Jefferson Heights neighborhood (78202) is located in the Eastside of downtown San Antonio. Residents in these two neighborhoods are exposed to drastically different socioeconomic conditions. For example, more than 90% of the residents in Elm Creek have at least a high school diploma. In sharp contrast, less than 70% of the residents in Jefferson Heights achieved a high school diploma or equivalent. 
Partly driven by the large disparity in educational attainment between two neighborhoods, the per capita income in 2019 in Elm Creek (`$`38,640) is almost two times higher than that of Jefferson Heights (`$`18,710). Compared to Elm Creek, where 12% of residents are below the poverty line, 38% of residents in Jefferson Heights fall below the poverty line. The difference between these neighborhoods is most pronounced between residents under 18 and older adults (over 65). While 17% of residents under 18 and 7% of senior residents in Elm Creek are below the poverty line, in Jefferson Heights these rates are three times higher. The ethnic and racial composition of the neighborhoods varies considerably. For instance, almost half the residents in Elm Creek are Hispanics (48%), while in Jefferson Heights, 60% are Hispanics. The non-Hispanic Whites and non-Hispanic Others  in Elm Creek are the 39% and 13% of its residents, respectively. In contrast, non-Hispanic Whites and non-Hispanic Others in Jefferson Heights are 11% and 29% of its residents, respectively.
We distributed the San Antonio Energy and Time Use Survey on March 22, 2021, using Qualtrics , a survey software tool used to design, send, and collect surveys online. From March 22 to March 24, we collected surveys from 1,022 respondents, of which 805 were valid responses with complete information on key demographic and socioeconomic information. We excluded 63 respondents from other zip codes and 154 respondents due to lack of information and inconsistencies with their response time. The final analytical sample consists of 805 respondents in total, of which 479 are from Elm Creek and 326 are from Jefferson Heights.
People of color are the majority of San Antonio's population, and their share of the total population continues to grow. As this demographic shift unfolds, their social and economic well-being will determine the future and prosperity of the city. In the next section, we present results related to occupation types and employment situation (e.g., frontline workers share, currently unemployed, and job loss), welfare benefits received, and material hardships that residents of Elm Creek and Jefferson Heights have experienced since the onset of COVID-19.

<h1>Key Findings</h1>
<br>
<h2>1) Job loss by race and ethnicity and by neighborhood</h2>
<br>
**The economic fallout in job loss varies little by neighborhood type, but racial inequalities prevail regardless. Almost half of Hispanic households experienced job loss, in comparison to a third of non-Hispanic White households**. 49.1% of Hispanics in Elm Creek and 48.1% of Hispanics in Jefferson Heights reported experiencing job loss during the pandemic, in comparison to 35.7% of non-Hispanic Whites in Elm Creek and 39.5% of non-Hispanic Whites in Jefferson Heights. Non-Hispanic Other (including Blacks, Asians, and other racial minorities) face higher rates of job loss than the other racial and ethnic groups, 12.4% in Elm Creek and 15.2% in Jefferson Heights.
	Figure 1 shows the percentage of respondents who experienced job loss since March 2020. This data is collected by using the survey question, “Since the onset of COVID-19 (March 2020), have you, or has anyone in your household experienced any of the following hardships?” Across figures, we represented Elm Creek with the brown circle (a more advantaged neighborhood), and Jefferson Heights with the dark blue circle (a more disadvantage neighborhood). The size of the circle is proportional to the number of respondents in each racial and ethnic group. We also display the margins of error for each proportion or mean shown. 

```{r moe_frontline, include=FALSE, message=FALSE, warning=FALSE}
#devtools::install_github("peterdalle/moe")
data.ec <- data %>% 
  filter(zipcode == "Elm Creek" & !is.na(frontline))

data.jh <- data %>% 
  filter(zipcode == "Jefferson Heights" & !is.na(frontline))

nec <- 230 + 171 + 64
njh <- 145 + 142 + 32

frontline.prop.ec <- prop.table(table(data.ec$frontline, data.ec$race_eth3), 2)
frontline.prop.jh <- prop.table(table(data.jh$frontline, data.jh$race_eth3), 2)

frontline_pct_ec <- c(0.4782609, 0.3236994, 0.1538462)
frontline_pct_jh <- c(0.5342466, 0.4100719, 0.3636364)

frontline_ec_moe <- sapply(frontline_pct_ec, FUN = moe, n = nec, population.correction = T, population.size = 18223)
frontline_jh_moe <- sapply(frontline_pct_jh, FUN = moe, n = njh, population.correction = T, population.size = 3812)

lower1 <- round(frontline_ec_moe[, 1]$conf.lower/100, 2)
upper1 <- round(frontline_ec_moe[, 1]$conf.upper/100, 2)

lower2 <- round(frontline_ec_moe[, 2]$conf.lower/100, 2)
upper2 <- round(frontline_ec_moe[, 2]$conf.upper/100, 2)

lower3 <- round(frontline_ec_moe[, 3]$conf.lower/100, 2)
upper3 <- round(frontline_ec_moe[, 3]$conf.upper/100, 2)

lower1b <- round(frontline_jh_moe[, 1]$conf.lower/100, 2)
upper1b <- round(frontline_jh_moe[, 1]$conf.upper/100, 2)

lower2b <- round(frontline_jh_moe[, 2]$conf.lower/100, 2)
upper2b <- round(frontline_jh_moe[, 2]$conf.upper/100, 2)

lower3b <- round(frontline_jh_moe[, 3]$conf.lower/100, 2)
upper3b <- round(frontline_jh_moe[, 3]$conf.upper/100, 2)
```
```{r moe_unemployed, include=FALSE, message=FALSE, warning=FALSE}
data <- data %>%
  mutate_at(vars(emp_status), ~if_else(. %in% c("Work for pay at a job","Temporarily absent from job"), "employed",
                                    if_else(. %in% c("Layoff from a job","Actively looking for a job"), "unemployed",
                                            if_else(. %in% c("Retired", "Unable to work"), "retired", "NA"))))
data.ec.unemp <- data %>% 
  filter(emp_status != "NA", zipcode == "Elm Creek")

data.jh.unemp <- data %>% 
  filter(emp_status != "NA", zipcode == "Jefferson Heights")

nec.unemp <- 230 + 171 + 64
njh.unemp <- 145 + 142 + 32

unemp.prop.ec <- prop.table(table(data.ec.unemp$emp_status, data.ec.unemp$race_eth3), 2)
unemp.prop.jh <- prop.table(table(data.jh.unemp$emp_status, data.jh.unemp$race_eth3), 2)

unemp_pct_ec <- c(0.14347826, 0.14619883, 0.20312500)
unemp_pct_jh <- c(0.10344828, 0.18309859, 0.37500000)

unemp_ec_moe <- sapply(unemp_pct_ec, FUN = moe, n = nec.unemp, population.correction = T, population.size = 18223)
unemp_jh_moe <- sapply(unemp_pct_jh, FUN = moe, n = njh.unemp, population.correction = T, population.size = 3812)

lower1u <- round(unemp_ec_moe[, 1]$conf.lower/100, 2)
upper1u <- round(unemp_ec_moe[, 1]$conf.upper/100, 2)

lower2u <- round(unemp_ec_moe[, 2]$conf.lower/100, 2)
upper2u <- round(unemp_ec_moe[, 2]$conf.upper/100, 2)

lower3u <- round(unemp_ec_moe[, 3]$conf.lower/100, 2)
upper3u <- round(unemp_ec_moe[, 3]$conf.upper/100, 2)

lower1bu <- round(unemp_jh_moe[, 1]$conf.lower/100, 2)
upper1bu <- round(unemp_jh_moe[, 1]$conf.upper/100, 2)

lower2bu <- round(unemp_jh_moe[, 2]$conf.lower/100, 2)
upper2bu <- round(unemp_jh_moe[, 2]$conf.upper/100, 2)

lower3bu <- round(unemp_jh_moe[, 3]$conf.lower/100, 2)
upper3bu <- round(unemp_jh_moe[, 3]$conf.upper/100, 2)
```
```{r moe_loss, include=FALSE, message=FALSE, warning=FALSE}
loss <- data %>%
  filter(hardships_1 == 1) %>% 
  group_by(zipcode, race_eth3) %>%
  summarize(n = n()) %>% 
  mutate(pct = n/sum(n),
         lbl = scales::percent(pct, accuracy = 0.1)) 

loss.ec <- loss %>% filter(zipcode == "Elm Creek")
loss.jh <- loss %>% filter(zipcode == "Jefferson Heights")

nec.loss <- sum(loss.ec$n)
njh.loss <- sum(loss.jh$n)

loss_ec_moe <- sapply(loss.ec$pct, FUN = moe, n = nec.loss, population.correction = T, population.size = 18223)
loss_jh_moe <- sapply(loss.jh$pct, FUN = moe, n = njh.loss, population.correction = T, population.size = 3812)

lower1u <- round(loss_ec_moe[, 1]$conf.lower/100, 2)
upper1u <- round(loss_ec_moe[, 1]$conf.upper/100, 2)

lower2u <- round(loss_ec_moe[, 2]$conf.lower/100, 2)
upper2u <- round(loss_ec_moe[, 2]$conf.upper/100, 2)

lower3u <- round(loss_ec_moe[, 3]$conf.lower/100, 2)
upper3u <- round(loss_ec_moe[, 3]$conf.upper/100, 2)

lower1bu <- round(loss_jh_moe[, 1]$conf.lower/100, 2)
upper1bu <- round(loss_jh_moe[, 1]$conf.upper/100, 2)

lower2bu <- round(loss_jh_moe[, 2]$conf.lower/100, 2)
upper2bu <- round(loss_jh_moe[, 2]$conf.upper/100, 2)

lower3bu <- round(loss_jh_moe[, 3]$conf.lower/100, 2)
upper3bu <- round(loss_jh_moe[, 3]$conf.upper/100, 2)

loss$lower <- c(lower1u, lower2u, lower3u, lower1bu, lower2bu, lower3bu)
loss$upper <- c(upper1u, upper2u, upper3u, upper1bu, upper2bu, upper3bu)
```
```{r moe_welfare, include=FALSE, message=FALSE, warning=FALSE}
welfare <- data %>%
  mutate_at(vars(welfare_1:welfare_7), ~if_else(. == "Yes", 1, 0))

welfare$total_welfare <- rowSums(welfare[, c("welfare_1","welfare_2","welfare_3","welfare_4","welfare_5","welfare_6","welfare_7")],
                                 na.rm = TRUE)
welfare <- welfare %>%
  filter(!is.na(welfare_1)&!is.na(welfare_2)&!is.na(welfare_3)&
           !is.na(welfare_4)&!is.na(welfare_5)&!is.na(welfare_6)&!is.na(welfare_7)) %>% 
  group_by(zipcode, race_eth3) %>%
  dplyr::summarize(n = n(),
            average_welfare = round(mean(total_welfare), 2),
            std.er.welfare = round(sd(total_welfare)/sqrt(length(total_welfare)), 2),
            crit.value = qt(0.975, df = length(total_welfare)-1),
            moe = crit.value*std.er.welfare,
            lower.welfare.ec = round(average_welfare - moe, 2),
            upper.welfare.ec = round(average_welfare + moe, 2))

welfare.ec <- c(1.77, 1.79, 1.63)
welfare.jh <- c(1.84, 1.86, 1.81)

t.test(welfare$average_welfare ~ welfare$zipcode)
summary(aov(formula = average_welfare ~ zipcode+race_eth3, data = welfare))
```
```{r moe_hardships, include=FALSE, message=FALSE, warning=FALSE}
loss.1 <- data %>% 
  filter(!is.na(hardships_1)) %>% 
  rename(hardships = hardships_1) %>% 
  group_by(zipcode, hardships) %>%
  summarize(n = n()) %>% 
  mutate(pct = n/sum(n),
         lbl = scales::percent(pct, accuracy = 0.1),
         hardships = if_else(hardships == 1, "Job loss", 
                               if_else(hardships == 0, "No difficulty", "NA"))) 

loss.2 <- data %>% 
  filter(!is.na(hardships_2)) %>% 
  rename(hardships = hardships_2) %>% 
  group_by(zipcode, hardships) %>%
  summarize(n = n()) %>% 
  mutate(pct = n/sum(n),
         lbl = scales::percent(pct, accuracy = 0.1),
         hardships = if_else(hardships == 1, "Paying utility bills", 
                               if_else(hardships == 0, "No difficulty", "NA")))  

loss.3 <- data %>% 
  filter(!is.na(hardships_3)) %>% 
  rename(hardships = hardships_3) %>% 
  group_by(zipcode, hardships) %>%
  summarize(n = n()) %>% 
  mutate(pct = n/sum(n),
         lbl = scales::percent(pct, accuracy = 0.1),
         hardships = if_else(hardships == 1, "Affording foods", 
                               if_else(hardships == 0, "No difficulty", "NA")))  

loss.4 <- data %>% 
  filter(!is.na(hardships_4)) %>% 
  rename(hardships = hardships_4) %>% 
  group_by(zipcode, hardships) %>%
  summarize(n = n()) %>% 
  mutate(pct = n/sum(n),
         lbl = scales::percent(pct, accuracy = 0.1),
         hardships = if_else(hardships == 1, "Paying rent/mortgage", 
                               if_else(hardships == 0, "No difficulty", "NA")))  

loss.5 <- data %>% 
  filter(!is.na(hardships_5)) %>% 
  rename(hardships = hardships_5) %>% 
  group_by(zipcode, hardships) %>%
  summarize(n = n()) %>% 
  mutate(pct = n/sum(n),
         lbl = scales::percent(pct, accuracy = 0.1),
         hardships = if_else(hardships == 1, "Paying medical bills", 
                               if_else(hardships == 0, "No difficulty", "NA")))  

loss.6 <- data %>% 
  filter(!is.na(hardships_6)) %>% 
  rename(hardships = hardships_6) %>% 
  group_by(zipcode, hardships) %>%
  summarize(n = n()) %>% 
  mutate(pct = n/sum(n),
         lbl = scales::percent(pct, accuracy = 0.1),
         hardships = if_else(hardships == 1, "Delay getting medical care", 
                               if_else(hardships == 0, "No difficulty", "NA")))  

hardships <- rbind(loss.1, loss.2, loss.3, loss.4, loss.5, loss.6)

hardships.ec <- hardships %>% 
  filter(zipcode == "Elm Creek", hardships != "No difficulty") %>% arrange(zipcode)

hardships.jh <- hardships %>% 
  filter(zipcode == "Jefferson Heights", hardships != "No difficulty") %>% arrange(zipcode)

hardships_pct_ec <- c(0.65484634, 0.20803783, 0.25059102, 0.26950355, 0.17494090, 0.08510638)
hardships_pct_jh <- c(0.6583630, 0.2206406, 0.2953737, 0.3202847, 0.1886121, 0.1281139)

hardships_ec_moe <- sapply(hardships_pct_ec, FUN = moe, n = 423, population.correction = T, population.size = 18223)
hardships_jh_moe <- sapply(hardships_pct_jh, FUN = moe, n = 281, population.correction = T, population.size = 3812)

lower1 <- round(hardships_ec_moe[, 1]$conf.lower/100, 2)
upper1 <- round(hardships_ec_moe[, 1]$conf.upper/100, 2)

lower2 <- round(hardships_ec_moe[, 2]$conf.lower/100, 2)
upper2 <- round(hardships_ec_moe[, 2]$conf.upper/100, 2)

lower3 <- round(hardships_ec_moe[, 3]$conf.lower/100, 2)
upper3 <- round(hardships_ec_moe[, 3]$conf.upper/100, 2)

lower4 <- round(hardships_ec_moe[, 4]$conf.lower/100, 2)
upper4 <- round(hardships_ec_moe[, 4]$conf.upper/100, 2)

lower5 <- round(hardships_ec_moe[, 5]$conf.lower/100, 2)
upper5 <- round(hardships_ec_moe[, 5]$conf.upper/100, 2)

lower6 <- round(hardships_ec_moe[, 6]$conf.lower/100, 2)
upper6 <- round(hardships_ec_moe[, 6]$conf.upper/100, 2)

lower1b <- round(hardships_jh_moe[, 1]$conf.lower/100, 2)
upper1b <- round(hardships_jh_moe[, 1]$conf.upper/100, 2)

lower2b <- round(hardships_jh_moe[, 2]$conf.lower/100, 2)
upper2b <- round(hardships_jh_moe[, 2]$conf.upper/100, 2)

lower3b <- round(hardships_jh_moe[, 3]$conf.lower/100, 2)
upper3b <- round(hardships_jh_moe[, 3]$conf.upper/100, 2)

lower4b <- round(hardships_jh_moe[, 4]$conf.lower/100, 2)
upper4b <- round(hardships_jh_moe[, 4]$conf.upper/100, 2)

lower5b <- round(hardships_jh_moe[, 5]$conf.lower/100, 2)
upper5b <- round(hardships_jh_moe[, 5]$conf.upper/100, 2)

lower6b <- round(hardships_jh_moe[, 6]$conf.lower/100, 2)
upper6b <- round(hardships_jh_moe[, 6]$conf.upper/100, 2)
```
```{r moe_bad, include=FALSE, message=FALSE, warning=FALSE}
bad <- data %>%
  filter(!is.na(bad)) %>% 
  group_by(zipcode, bad) %>%
  summarize(n = n()) %>% 
  mutate(pct = n/sum(n),
         lbl = scales::percent(pct, accuracy = 0.1))

bad.ec <- bad %>% filter(zipcode == "Elm Creek")
bad.jh <- bad %>% filter(zipcode == "Jefferson Heights")

nec.bad <- sum(bad.ec$n)
njh.bad <- sum(bad.jh$n)

bad_ec_moe <- sapply(bad.ec$pct, FUN = moe, n = nec.bad, population.correction = T, population.size = 18223)
bad_jh_moe <- sapply(bad.jh$pct, FUN = moe, n = njh.bad, population.correction = T, population.size = 3812)

lower1bad <- round(bad_ec_moe[, 1]$conf.lower/100, 2)
upper1bad <- round(bad_ec_moe[, 1]$conf.upper/100, 2)

lower2bad <- round(bad_ec_moe[, 2]$conf.lower/100, 2)
upper2bad <- round(bad_ec_moe[, 2]$conf.upper/100, 2)

lower3bad <- round(bad_ec_moe[, 3]$conf.lower/100, 2)
upper3bad <- round(bad_ec_moe[, 3]$conf.upper/100, 2)

lower1bbad <- round(bad_jh_moe[, 1]$conf.lower/100, 2)
upper1bbad <- round(bad_jh_moe[, 1]$conf.upper/100, 2)

lower2bbad <- round(bad_jh_moe[, 2]$conf.lower/100, 2)
upper2bbad <- round(bad_jh_moe[, 2]$conf.upper/100, 2)

lower3bbad <- round(bad_jh_moe[, 3]$conf.lower/100, 2)
upper3bbad <- round(bad_jh_moe[, 3]$conf.upper/100, 2)

bad$lower <- c(lower1bad, lower2bad, lower3bad, lower1bbad, lower2bbad, lower3bbad)
bad$upper <- c(upper1bad, upper2bad, upper3bad, upper1bbad, upper2bbad, upper3bbad)
```

```{r frontline_plot, message=FALSE, warning=FALSE, include=FALSE}
frontline <- NULL
total <- NULL
frontline_pct <- NULL

total <- data %>%
  filter(!is.na(frontline)) %>% 
  group_by(zipcode, race_eth3) %>%
  summarize(n = n())

frontline <- data %>%
  filter(frontline == "Yes") %>%
  group_by(zipcode, race_eth3) %>%
  summarize(frontline_n = n())

frontline_pct <- data.frame(total[,"zipcode"], total[,"race_eth3"], total[,"n"], frontline[,"frontline_n"])

frontline_pct <- frontline_pct %>%
  mutate(pct = frontline_n/n,
               lbl = scales::percent(pct, accuracy = 0.1))

frontline_pct$lower <- c(lower1, lower2, lower3, lower1b, lower2b, lower3b)
frontline_pct$upper <- c(upper1, upper2, upper3, upper1b, upper2b, upper3b)

frontline_pct %>%
  ggplot(aes(x = pct, y = reorder(race_eth3, pct), color = zipcode)) + 
  geom_errorbar(aes(xmin = lower, xmax = upper), show.legend = F, width = 0.15) +
  geom_point(aes(size = n)) +
  geom_text_repel(aes(label = lbl), size = 8, color = "gray10", segment.alpha = 0, family = "foo", nudge_y = .3, nudge_x = .01) +
  scale_x_continuous(limits = c(0, .6), breaks = seq(0, 1, .15), label = scales::percent) +
  scale_color_manual(values = wes_palette("Darjeeling2", n = 3)) +
  guides(color = guide_legend(label.position = "left", label.vjust = 0.5, label.hjust = 1, override.aes = list(size = 5)),
         size = F) +
  labs(y = NULL, x = NULL, color = NULL,
       title = "Figure 1. Frontline workers by race and ethnicity", 
       subtitle = str_wrap("Are you a frontline worker?"),
       caption = "Source: 2021 San Antonio Energy and Time Use Survey") +
  theme_minimal() +
  themeuf

ggsave(filename = "figure_1.png", plot = last_plot(), path = "~/GitHub/saetus/", width = 6, height = 4.5, units = "in", dpi = "print")
```

```{r unemp_plot, warning=FALSE, message=FALSE, include=FALSE}
total <- data %>%
  filter(emp_status != "NA") %>%
  group_by(zipcode, race_eth3) %>%
  summarize(n = n())

unemployed <- data %>%
  filter(emp_status == "unemployed") %>%
  group_by(zipcode, race_eth3) %>%
  summarize(unemployed_n = n())

unemployed <- data.frame(unemployed)

colnames(unemployed) <- c("zipcode","race_eth3","unemployed_n")

unemployed <- unemployed[with(unemployed, order(zipcode, race_eth3)),] 

unemployed_pct <- data.frame(total[,"zipcode"], total[,"race_eth3"], total[,"n"], unemployed[,"unemployed_n"])

colnames(unemployed_pct) <- c("zipcode","race_eth3","n","unemployed_n")

unemployed_pct$unemployed_n <- as.numeric(unemployed_pct$unemployed_n)

unemployed_pct <- unemployed_pct %>%
        mutate(pct = unemployed_n/n,
               lbl = scales::percent(pct, accuracy = 0.1))

unemployed_pct$lower <- c(lower1u, lower2u, lower3u, lower1bu, lower2bu, lower3bu)
unemployed_pct$upper <- c(upper1u, upper2u, upper3u, upper1bu, upper2bu, upper3bu)

fig2 <- unemployed_pct %>%
  ggplot(aes(x = pct, y = reorder(race_eth3, -pct), color = zipcode)) + 
  geom_errorbar(aes(xmin = lower, xmax = upper), show.legend = F, width = 0.1) +
  geom_point(aes(size = n)) +
  geom_text_repel(aes(label = lbl), size = 7, color = "gray10", segment.alpha = 0, family = "foo", nudge_y = .3, nudge_x = .01) +
  scale_x_continuous(limits = c(0, .45), breaks = seq(0, 1, .15), label = scales::percent) +
  scale_color_manual(values = wes_palette("Darjeeling2", n = 3)) +
  guides(color = guide_legend(label.position = "left", label.vjust = 0.5, label.hjust = 1, override.aes = list(size = 5)), 
         size = F) +
  labs(y = NULL, x = NULL, color = NULL, 
       subtitle = "A) Unemployment by race and ethnicity") +
  theme_classic() +
  themeuf + theme(legend.position = "bottom") 

ggsave(filename = "figure_2.png", plot = last_plot(), path = "~/GitHub/saetus/", width = 6, height = 4.5, units = "in", dpi = "print")
```

```{r loss_income_plot, include=FALSE, message=FALSE}
fig3 <- loss %>% 
  ggplot(aes(x = pct, y = reorder(race_eth3, pct), color = zipcode)) +
  geom_errorbar(aes(xmin = lower, xmax = upper), show.legend = F, width = 0.1) +
  geom_point(stat = "identity", aes(size = n)) +
  geom_text_repel(aes(label = lbl), size = 8, color = "gray10", segment.alpha = 0, family = "foo", nudge_y = .25, nudge_x = .01) +
  scale_x_continuous(limits = c(0, .6), breaks = seq(0, 1, .15), label = scales::percent) +
  scale_color_manual(values = wes_palette("Darjeeling2", n = 3)) +
  guides(color = guide_legend(label.position = "left", label.vjust = 0.5, label.hjust = 1, override.aes = list(size = 5)),
         size = FALSE) +
  labs(y = NULL, x = NULL, color = NULL, size = NULL,
       title = "Figure 1. Job loss exprienced by race and ethnicity",
       subtitle = 
         str_wrap("Since the onset of COVID-19 (March 2020), have you, or has anyone in your household experienced job lobss?", 
                  width = 85),
       caption = "Source: 2021 San Antonio Energy and Time Use Survey") +
  theme_minimal() +
  themeuf + theme(legend.position = "top")

ggsave(filename = "figure_1_new.png", plot = fig3, path = "~/GitHub/saetus/", width = 6, height = 4.5, units = "in", dpi = "print")

fig3

# new.fig2 <- fig2 + fig3 + 
#   plot_annotation(title = "Figure 1. Job loss experienced by neighborhood and by race and ethnicity",
#                                           caption = "Source: 2021 San Antonio Energy and Time Use Survey", 
#                                           theme = themeuf) +
#   plot_layout(guides = "collect") & theme(legend.position = "bottom")
# 
# ggsave(filename = "figure_new_2.png", plot = last_plot(), path = "~/GitHub/saetus/",
#        width = 6, height = 4.5, units = "in", dpi = "print")
```

<h2>2) Material hardships by race and ethnicity and by neighborhood</h2>
<br>
**The hardship most experienced in both neighborhoods since the start of the pandemic was job loss, followed by difficulties paying rent, affording food, and delaying medical care.** Material hardship is defined as going without basic needs like food, medical care, housing, or utilities due to a lack of money. We do not observe a statistical difference between the different hardships experienced (e.g., job loss, difficulty in paying the next rent or mortgage payment, difficulty in affording the kinds of food need, difficulty in paying utility bills, difficulty in paying medical bills or health insurance and delaying getting medical care or prescription medication) among the residents in Jefferson Heights and Elm Creek. Figure 2 shows that almost two-thirds of the respondents in both neighborhoods claimed that they or someone else in their household has lost their job since the COVID-19 outbreak. Additionally, 27% of respondents in Elm Creek and 32% in Jefferson Heights said they have problems with paying their rent/mortgage after beginning of the COVID-19 pandemic. The least frequent hardship experienced among residents of both neighborhoods was delayed medical care, 9% in Elm Creek and 13% of respondents in Jefferson Heights. In Figure 3 we shown that among Hispanics in both neighborhoods there is no difference between the residents that experienced difficulties affording food, paying rent or mortgage and delay getting medical care. A third of non-Hispanic Whites in Elm Creek had trouble affording food compared to 43.4% of Whites in Jefferson Heights. More than half of Whites in Jefferson Heights delay getting medical care, in comparison with 41.7% of Whites in Elm Creek. About three times more of non-Hispanic Others in Elm Creek (16.7%) than in Jefferson Heights (5.6%) delay getting medical care. 3.5% of non-Hispanic Others in Elm Creek had difficulties paying rent or mortgage, almost four times less than non-Hispanic Others in Jefferson Heights (12.2%).
```{r hardships_plots, message=FALSE, include=FALSE}
hardships <- hardships %>% filter(hardships != "No difficulty") %>%  arrange(zipcode)

hardships$lower <- c(lower1, lower2, lower3, lower4, lower5, lower6, lower1b, lower2b, lower3b, lower4b, lower5b, lower6b)  
hardships$upper <- c(upper1, upper2, upper3, upper4, upper5, upper6, upper1b, upper2b, upper3b, upper4b, upper5b, upper6b)  

# hardships %>% 
#   filter(hardships != "Job loss") %>% 
#   ggplot(aes(x = pct, y = reorder(hardships, pct), color = zipcode)) +
#   geom_errorbar(aes(xmin = lower, xmax = upper), show.legend = F, width = 0.15) +
#   geom_point(stat = "identity", aes(size = n)) +
#   geom_text_repel(aes(label = lbl), size = 7, color = "gray10", segment.alpha = 0, family = "foo", nudge_y = .3) +
#   scale_x_continuous(limits = c(0, .45), breaks = seq(0, 1, .15), label = scales::percent) +
#   scale_color_manual(values = wes_palette("Darjeeling2", n = 3)) +
#   guides(color = guide_legend(label.position = "left", label.vjust = 0.5, label.hjust = 1, override.aes = list(size = 5)), 
#          size = F) +
#   labs(y = NULL, x = NULL, color = NULL,
#        title = "Figure 5. Material hardships experienced by zip code", 
#        subtitle = str_wrap("Since the onset of COVID-19 (March 2020), have you, or has anyone in your household experienced any of the following material hardships"),
#        caption = "Source: 2021 San Antonio Energy and Time Use Survey") +
#   theme_classic() +
#   themeuf

#ggsave(filename = "figure_5.png", plot = last_plot(), path = "~/GitHub/saetus/", width = 6, height = 4.5, units = "in", dpi = "print")

fig5 <- hardships %>% 
  ggplot(aes(x = pct, y = reorder(hardships, pct), color = zipcode)) +
  geom_errorbar(aes(xmin = lower, xmax = upper), show.legend = F, width = 0.1) +
  geom_point(stat = "identity", aes(size = n)) +
  geom_text_repel(aes(label = lbl), size = 8, color = "gray10", segment.alpha = 0, family = "foo", nudge_y = .25, nudge_x = .02) +
  scale_x_continuous(limits = c(0, .75), breaks = seq(0, 1, .15), label = scales::percent) +
  scale_color_manual(values = wes_palette("Darjeeling2", n = 3)) +
  guides(color = guide_legend(label.position = "left", label.vjust = 0.5, label.hjust = 1, override.aes = list(size = 5)), 
         size = F) +
  labs(y = NULL, x = NULL, color = NULL,
       caption = "Source: 2021 San Antonio Energy and Time Use Survey",
       title = "Figure 2. Material hardships experienced by zip code",
       subtitle = 
         str_wrap("Since the onset of COVID-19 (March 2020), have you, or has anyone in your household experienced any of the following?", width = 85)) +
  theme_minimal() +
  themeuf + theme(legend.position = "top", plot.subtitle = element_text(hjust = 0.5))

ggsave(filename = "figure_4_newnew.png", plot = fig5, path = "~/GitHub/saetus/", width = 6, height = 4.5, units = "in", dpi = "print")

# fig6 <- bad %>%
#   ggplot(aes(x = pct, y = reorder(bad, pct), color = zipcode)) +
#   geom_errorbar(aes(xmin = lower, xmax = upper), show.legend = F, width = 0.1) +
#   geom_point(stat = "identity", aes(size = n)) +
#   geom_text_repel(aes(label = lbl), size = 7, color = "gray10", segment.alpha = 0, family = "foo", nudge_y = .2, nudge_x = .02) +
#   scale_x_continuous(limits = c(0, .7), breaks = seq(0, 1, .15), label = scales::percent) +
#   scale_color_manual(values = wes_palette("Darjeeling2", n = 3)) +
#   guides(color = guide_legend(label.position = "left", label.vjust = 0.5, label.hjust = 1, override.aes = list(size = 5)), 
#          size = F) +
#   labs(y = NULL, x = NULL, color = NULL,
#        subtitle = str_wrap("B) Number of hardships")) +
#   theme_classic() +
#   themeuf + theme(legend.position = "bottom", plot.subtitle = element_text(hjust = 0))
# 
# ggsave(filename = "figure_7.png", plot = last_plot(), path = "~/GitHub/saetus/", width = 6, height = 4.5, units = "in", dpi = "print")
# 
# new.fig4 <- fig5 / fig6 + 
#   plot_annotation(title = "Figure 4. Material hardships experienced by zip code",
#                                           caption = "Source: 2021 San Antonio Energy and Time Use Survey", 
#                                           theme = themeuf) +
#   plot_layout(guides = "collect") & theme(legend.position = "bottom")
# 
# ggsave(filename = "figure_new_4.png", plot = last_plot(), path = "~/GitHub/saetus/", 
#        width = 6, height = 8, units = "in", dpi = "print")
```

```{r, include=FALSE, message=FALSE, include=FALSE}
loss.1r <- data %>% 
  filter(!is.na(hardships_1)) %>% 
  rename(hardships = hardships_1) %>% 
  group_by(zipcode, hardships, race_eth3) %>%
  summarize(n = n()) %>% 
  mutate(pct = n/sum(n),
         lbl = scales::percent(pct, accuracy = 0.1),
         hardships = if_else(hardships == 1, "Job loss", 
                               if_else(hardships == 0, "No difficulty", "NA"))) 

loss.2r <- data %>% 
  filter(!is.na(hardships_2)) %>% 
  rename(hardships = hardships_2) %>% 
  group_by(zipcode, hardships, race_eth3) %>%
  summarize(n = n()) %>% 
  mutate(pct = n/sum(n),
         lbl = scales::percent(pct, accuracy = 0.1),
         hardships = if_else(hardships == 1, "Paying utility bills", 
                               if_else(hardships == 0, "No difficulty", "NA")))  

loss.3r <- data %>% 
  filter(!is.na(hardships_3)) %>% 
  rename(hardships = hardships_3) %>% 
  group_by(zipcode, hardships, race_eth3) %>%
  summarize(n = n()) %>% 
  mutate(pct = n/sum(n),
         lbl = scales::percent(pct, accuracy = 0.1),
         hardships = if_else(hardships == 1, "Affording food", 
                               if_else(hardships == 0, "No difficulty", "NA")))  

loss.4r <- data %>% 
  filter(!is.na(hardships_4)) %>% 
  rename(hardships = hardships_4) %>% 
  group_by(zipcode, hardships, race_eth3) %>%
  summarize(n = n()) %>% 
  mutate(pct = n/sum(n),
         lbl = scales::percent(pct, accuracy = 0.1),
         hardships = if_else(hardships == 1, "Paying rent/mortgage", 
                               if_else(hardships == 0, "No difficulty", "NA")))  

loss.5r <- data %>% 
  filter(!is.na(hardships_5)) %>% 
  rename(hardships = hardships_5) %>% 
  group_by(zipcode, hardships, race_eth3) %>%
  summarize(n = n()) %>% 
  mutate(pct = n/sum(n),
         lbl = scales::percent(pct, accuracy = 0.1),
         hardships = if_else(hardships == 1, "Paying medical bills", 
                               if_else(hardships == 0, "No difficulty", "NA")))  

loss.6r <- data %>% 
  filter(!is.na(hardships_6)) %>% 
  rename(hardships = hardships_6) %>% 
  group_by(zipcode, hardships, race_eth3) %>%
  summarize(n = n()) %>% 
  mutate(pct = n/sum(n),
         lbl = scales::percent(pct, accuracy = 0.1),
         hardships = if_else(hardships == 1, "Delay getting medical care", 
                               if_else(hardships == 0, "No difficulty", "NA")))  

hardships.r <- rbind(loss.1r, loss.2r, loss.3r, loss.4r, loss.5r, loss.6r)
```

```{r moe_race_hards, message=FALSE, warning=FALSE, include=FALSE}
hardships.r.ec <- hardships.r %>% filter(zipcode == "Elm Creek", hardships != "No difficulty") %>% arrange(zipcode)
hardships.r.jh <- hardships.r %>% filter(zipcode == "Jefferson Heights", hardships != "No difficulty") %>% arrange(zipcode)

hardships_pct_ec_r <- c(0.49097473, 0.35740072, 0.15162455, 0.46590909, 0.26136364, 0.27272727, 0.52830189, 0.33018868, 0.14150943,
                        0.58771930, 0.37719298, 0.03508772, 0.54054054, 0.37837838, 0.08108108, 0.41666667, 0.41666667, 0.16666667)
hardships_pct_jh_r <- c(0.48108108, 0.39459459, 0.12432432, 0.50000000, 0.40322581, 0.09677419, 0.43373494, 0.43373494, 0.13253012,
                        0.56666667, 0.31111111, 0.12222222, 0.50943396, 0.37735849, 0.11320755, 0.41666667, 0.52777778, 0.05555556)

hardships_ec_r_moe <- sapply(hardships_pct_ec_r, FUN = moe, n = 423, population.correction = T, population.size = 18223)
hardships_jh_r_moe <- sapply(hardships_pct_jh_r, FUN = moe, n = 281, population.correction = T, population.size = 3812)

lower1r <- round(hardships_ec_r_moe[, 1]$conf.lower/100, 2)
upper1r <- round(hardships_ec_r_moe[, 1]$conf.upper/100, 2)

lower2r <- round(hardships_ec_r_moe[, 2]$conf.lower/100, 2)
upper2r <- round(hardships_ec_r_moe[, 2]$conf.upper/100, 2)

lower3r <- round(hardships_ec_r_moe[, 3]$conf.lower/100, 2)
upper3r <- round(hardships_ec_r_moe[, 3]$conf.upper/100, 2)

lower4r <- round(hardships_ec_r_moe[, 4]$conf.lower/100, 2)
upper4r <- round(hardships_ec_r_moe[, 4]$conf.upper/100, 2)

lower5r <- round(hardships_ec_r_moe[, 5]$conf.lower/100, 2)
upper5r <- round(hardships_ec_r_moe[, 5]$conf.upper/100, 2)

lower6r <- round(hardships_ec_r_moe[, 6]$conf.lower/100, 2)
upper6r <- round(hardships_ec_r_moe[, 6]$conf.upper/100, 2)

lower7r <- round(hardships_ec_r_moe[, 7]$conf.lower/100, 2)
upper7r <- round(hardships_ec_r_moe[, 7]$conf.upper/100, 2)

lower8r <- round(hardships_ec_r_moe[, 8]$conf.lower/100, 2)
upper8r <- round(hardships_ec_r_moe[, 8]$conf.upper/100, 2)

lower9r <- round(hardships_ec_r_moe[, 9]$conf.lower/100, 2)
upper9r <- round(hardships_ec_r_moe[, 9]$conf.upper/100, 2)

lower10r <- round(hardships_ec_r_moe[, 10]$conf.lower/100, 2)
upper10r <- round(hardships_ec_r_moe[, 10]$conf.upper/100, 2)

lower11r <- round(hardships_ec_r_moe[, 11]$conf.lower/100, 2)
upper11r <- round(hardships_ec_r_moe[, 11]$conf.upper/100, 2)

lower12r <- round(hardships_ec_r_moe[, 12]$conf.lower/100, 2)
upper12r <- round(hardships_ec_r_moe[, 12]$conf.upper/100, 2)

lower13r <- round(hardships_ec_r_moe[, 13]$conf.lower/100, 2)
upper13r <- round(hardships_ec_r_moe[, 13]$conf.upper/100, 2)

lower14r <- round(hardships_ec_r_moe[, 14]$conf.lower/100, 2)
upper14r <- round(hardships_ec_r_moe[, 14]$conf.upper/100, 2)

lower15r <- round(hardships_ec_r_moe[, 15]$conf.lower/100, 2)
upper15r <- round(hardships_ec_r_moe[, 15]$conf.upper/100, 2)

lower16r <- round(hardships_ec_r_moe[, 16]$conf.lower/100, 2)
upper16r <- round(hardships_ec_r_moe[, 16]$conf.upper/100, 2)

lower17r <- round(hardships_ec_r_moe[, 17]$conf.lower/100, 2)
upper17r <- round(hardships_ec_r_moe[, 17]$conf.upper/100, 2)

lower18r <- round(hardships_ec_r_moe[, 18]$conf.lower/100, 2)
upper18r <- round(hardships_ec_r_moe[, 18]$conf.upper/100, 2)

lower1br <- round(hardships_jh_r_moe[, 1]$conf.lower/100, 2)
upper1br <- round(hardships_jh_r_moe[, 1]$conf.upper/100, 2)

lower2br <- round(hardships_jh_r_moe[, 2]$conf.lower/100, 2)
upper2br <- round(hardships_jh_r_moe[, 2]$conf.upper/100, 2)

lower3br <- round(hardships_jh_r_moe[, 3]$conf.lower/100, 2)
upper3br <- round(hardships_jh_r_moe[, 3]$conf.upper/100, 2)

lower4br <- round(hardships_jh_r_moe[, 4]$conf.lower/100, 2)
upper4br <- round(hardships_jh_r_moe[, 4]$conf.upper/100, 2)

lower5br <- round(hardships_jh_r_moe[, 5]$conf.lower/100, 2)
upper5br <- round(hardships_jh_r_moe[, 5]$conf.upper/100, 2)

lower6br <- round(hardships_jh_r_moe[, 6]$conf.lower/100, 2)
upper6br <- round(hardships_jh_r_moe[, 6]$conf.upper/100, 2)

lower7br <- round(hardships_jh_r_moe[, 7]$conf.lower/100, 2)
upper7br <- round(hardships_jh_r_moe[, 7]$conf.upper/100, 2)

lower8br <- round(hardships_jh_r_moe[, 8]$conf.lower/100, 2)
upper8br <- round(hardships_jh_r_moe[, 8]$conf.upper/100, 2)

lower9br <- round(hardships_jh_r_moe[, 9]$conf.lower/100, 2)
upper9br <- round(hardships_jh_r_moe[, 9]$conf.upper/100, 2)

lower10br <- round(hardships_jh_r_moe[, 10]$conf.lower/100, 2)
upper10br <- round(hardships_jh_r_moe[, 10]$conf.upper/100, 2)

lower11br <- round(hardships_jh_r_moe[, 11]$conf.lower/100, 2)
upper11br <- round(hardships_jh_r_moe[, 11]$conf.upper/100, 2)

lower12br <- round(hardships_jh_r_moe[, 12]$conf.lower/100, 2)
upper12br <- round(hardships_jh_r_moe[, 12]$conf.upper/100, 2)

lower13br <- round(hardships_jh_r_moe[, 13]$conf.lower/100, 2)
upper13br <- round(hardships_jh_r_moe[, 13]$conf.upper/100, 2)

lower14br <- round(hardships_jh_r_moe[, 14]$conf.lower/100, 2)
upper14br <- round(hardships_jh_r_moe[, 14]$conf.upper/100, 2)

lower15br <- round(hardships_jh_r_moe[, 15]$conf.lower/100, 2)
upper15br <- round(hardships_jh_r_moe[, 15]$conf.upper/100, 2)

lower16br <- round(hardships_jh_r_moe[, 16]$conf.lower/100, 2)
upper16br <- round(hardships_jh_r_moe[, 16]$conf.upper/100, 2)

lower17br <- round(hardships_jh_r_moe[, 17]$conf.lower/100, 2)
upper17br <- round(hardships_jh_r_moe[, 17]$conf.upper/100, 2)

lower18br <- round(hardships_jh_r_moe[, 18]$conf.lower/100, 2)
upper18br <- round(hardships_jh_r_moe[, 18]$conf.upper/100, 2)
```

```{r plot_figure_2, message=FALSE, warning=FALSE}
fig5
```

```{r plot_figure_3, message=FALSE, warning=FALSE}
# facet names
hardships_lbl <- c("Job loss", "Paying utility bills", "Food insecurity", "Paying rent/mortgage", 
                   "Paying medical bills", "Delay medical care")
names(hardships_lbl) <- c("Job loss", "Paying utility bills", "Affording food", "Paying rent/mortgage", 
                   "Paying medical bills", "Delay getting medical care")

hardships.r <- hardships.r %>% filter(hardships != "No difficulty") %>%  arrange(zipcode)

hardships.r$lower <- c(lower1r, lower2r, lower3r, lower4r, lower5r, lower6r, lower7r, lower8r, lower9r, lower10r,
                       lower11r, lower12r, lower13r, lower14r, lower15r, lower16r, lower17r, lower18r, 
                       lower1br, lower2br, lower3br, lower4br, lower5br, lower6br, lower7br, lower8br, lower9br, lower10br,
                       lower11br, lower12br, lower13br, lower14br, lower15br, lower16br, lower17br, lower18br)
hardships.r$upper <- c(upper1r, upper2r, upper3r, upper4r, upper5r, upper6r, upper7r, upper8r, upper9r, upper10r,
                       upper11r, upper12r, upper13r, upper14r, upper15r, upper16r, upper17r, upper18r,
                       upper1br, upper2br, upper3br, upper4br, upper5br, upper6br, upper7br, upper8br, upper9br, upper10br,
                       upper11br, upper12br, upper13br, upper14br, upper15br, upper16br, upper17br, upper18br)

hardships.r %>% 
  filter(hardships != "No difficulty", 
         (hardships=="Affording food" | hardships=="Paying rent/mortgage" | hardships=="Delay getting medical care"))%>% 
  ggplot(aes(x = pct, y = reorder(race_eth3, pct), color = zipcode)) +
  geom_errorbar(aes(xmin = lower, xmax = upper), show.legend = F, width = 0.1) +
  geom_point(stat = "identity", aes(size = n)) +
  geom_text_repel(aes(label = lbl), size = 8, color = "gray10", segment.alpha = 0, family = "foo", nudge_y = .2, nudge_x = .025) +
  scale_x_continuous(limits = c(0, .65), breaks = seq(0, 1, .15), label = scales::percent) +
  scale_color_manual(values = wes_palette("Darjeeling2", n = 3)) +
  guides(color = guide_legend(label.position = "left", label.vjust = 0.5, label.hjust = 1, override.aes = list(size = 5)), 
         size = F) +
  facet_grid(~hardships, labeller = labeller(hardships = hardships_lbl), shrink = T, scales = "free") +
  labs(y = NULL, x = NULL, color = NULL,
       title = "Figure 3. Main hardships experienced by race and ethnicity", 
       subtitle = str_wrap("Since the onset of COVID-19 (March 2020), have you, or has anyone in your household experienced any of the following hardships"),
       caption = "Source: 2021 San Antonio Energy and Time Use Survey") +
  theme_minimal() +
  themeuf + theme(legend.position = "top", strip.text = element_text(size = 27))

ggsave(filename = "figure_3_newnew.png", plot = last_plot(), path = "~/GitHub/saetus/", width = 7, height = 4.5, units = "in", dpi = "print")

# data %>%
#   filter(!is.na(bad)) %>% 
#   group_by(zipcode, bad, race_eth3) %>%
#   summarize(n = n()) %>% 
#   mutate(pct = n/sum(n),
#          lbl = scales::percent(pct, accuracy = 0.1)) %>% 
#   ggplot(aes(x = pct, y = reorder(race_eth3, pct), color = zipcode)) +
#   geom_point(aes(size = n)) +
#   geom_text_repel(aes(label = lbl), size = 5, color = "gray30", segment.alpha = 0, family = "foo", nudge_y = .2, nudge_x = .01) +
#   scale_x_continuous(limits = c(0, .75), breaks = seq(0, 1, .15), label = scales::percent) +
#   scale_color_manual(values = wes_palette("Darjeeling2", n = 3)) +
#   guides(color = guide_legend(label.position = "left", label.vjust = 0.5, label.hjust = 1, override.aes = list(size = 5)), 
#          size = F) +
#   facet_grid(~bad, scales = "free") +
#   labs(y = NULL, x = NULL, color = NULL,
#        title = "Number of hardships by zip code", 
#        subtitle = str_wrap("Since the onset of COVID-19 (March 2020), have you, or has anyone in your household experienced any type of hardships"),
#        caption = "Source: 2021 San Antonio Energy and Time Use Survey") +
#   theme_classic() +
#   themeuf + theme(axis.text.x = element_text(color = "gray40", size = 18))
```

<h2>3) The average number of welfare benefits by race and ethnicity</h2> 
<br>
Households within both Elm Creek and Jefferson Heights have experienced all kinds of hardships during the pandemic, so it is unsurprising that the use of welfare benefits has been on the rise. Figure 3 shows the average number of welfare benefits per household. We considered “welfare benefits” anyone in the household receiving any of the following: unemployment insurance, social security benefits (retirement, disability, or survivors), supplemental security income, Medicare benefits, stimulus payment(s), supplemental nutrition assistance program (SNAP), and other types of need-based assistance from the city or federal government. Although we do not find major differences between racial and ethnic groups, non-Hispanic Others in Elm Creek have received the fewest welfare benefits on average, while non-Hispanic Whites in Jefferson Heights have received the most. 
```{r ave_welfare_plot, message=FALSE, warning=FALSE}
welfare$race_eth3 <- factor(welfare$race_eth3, ordered = F)
welfare$order <- c(1, 2, 3, 1, 2, 3)

welfare %>%
  ggplot(aes(x = average_welfare, y = reorder(race_eth3, -order), color = zipcode)) + 
  geom_errorbar(aes(xmin = lower.welfare.ec, xmax = upper.welfare.ec), show.legend = F, width = 0.1) +
  geom_point(aes(size = n)) +
  geom_text_repel(aes(label = round(average_welfare, 2)), 
                  size = 8, color = "gray10", segment.alpha = 0, family = "foo", nudge_y = .3, nudge_x = .01) +
  scale_x_continuous(breaks = seq(1, 2.3, .1), limits = c(1.3, 2.3)) +
  scale_color_manual(values = wes_palette("Darjeeling2", n = 3)) +
  guides(color = guide_legend(label.position = "left", label.vjust = 0.5, label.hjust = 1, override.aes = list(size = 5)),
         size = FALSE) +
  labs(y = NULL, x = NULL, color = NULL,
       title = "Figure 4. Average number of welfare benefits by race and ethnicity", 
       subtitle = str_wrap("Have you, or has anyone in your household received any type of welfare benefit?"),
       caption = "Source: 2021 San Antonio Energy and Time Use Survey") +
  theme_minimal() + 
  themeuf

ggsave(filename = "figure_4.png", plot = last_plot(), path = "~/GitHub/saetus/", width = 6, height = 4.5, units = "in", dpi = "print")
```

<h1>Lessons from the San Antonio Energy and Time Use Survey </h1>
<br>
The effects of the pandemic on the economy have reached everyone. The economic hardships are likely to be unequally distributed and shaped by different local neighborhood conditions. 
The disproportionate social and economic impacts in Texas and elsewhere following COVID-19 reflect harsh, longstanding inequalities in employment and other spheres of social life. The early findings discussed here show how the impacts of the COVID-19 pandemic have been incredibly broad among the workforce in two distinct San Antonio neighborhoods. Jefferson Heights is characterized by a greater share of frontline workers. This can have important implications for SARS-CoV-2 transmission and geographic variation in the burden of COVID-19 cases in San Antonio, as frontline workers are more likely to be exposed to the virus.
The Household Pulse Survey  shows for June 2020 that 51.1% of the US residents and 53.5% of Texans lost their jobs. We ask a similar question to find out that in March 2021, about 65.5% in Elm Creek and 65.8% in Jefferson Heights lost their jobs. We find that the most common hardship people suffered during the pandemic was losing their job, but that there are important disparities, as exemplified by 37.5% of unemployed Non-Hispanic Others in Jefferson Heights compared to just 20.3% in Elm Creek. Although we did not observe a statistically significant difference in job loss between these two neighborhoods, nearly half of Hispanics who participated in the survey lost their job since the onset of COVID-19 (48.1% in Jefferson Heights and 49.1% in Elm Creek). Additionally, we find greater use of state and federal welfare mechanisms in Jefferson Heights than in Elm Creek, although these results are not statistically significant. This highlights the need to ensure that residents of Jefferson Heights and similar neighborhoods are aware of, and have access to, any and all relevant local, state, or federal aid, particularly since these neighborhoods likely bear the brunt of the pandemic.
As attention begins to turn to COVID-19 recovery, it is critically important to remember that neighborhoods were impacted – and continue to be impacted – differently. These disparities will shape the trajectory and speed of their recovery for better or worse. Beyond the obvious measures of socioeconomic status that may contribute to faster recovery, social capital (resources available to people through their social networks) is also associated with recovery through several mechanisms (Aldrich, 2011). These include the presence of “social safety nets” that can provide financial and physical assistance as well as the ability of better connected and politically active communities to more effectively interact with authorities and obtain resources. Following the 1995 Kobe earthquake in Japan, social capital was the strongest predictor of population recovery (Aldrich, 2011). In the US, social capital varies widely and is known to be protective against COVID-19 deaths and hospitalizations (Borgonovi et al., 2021). Recovery efforts in San Antonio should keep the “social infrastructure” of neighborhoods in mind when planning. Additionally, we suggest that recovery efforts should also seek – wherever possible – to improve existing disparities in housing, social capital, access to healthcare, and other factors that collectively contribute to social vulnerability (Finch et al., 2010). It is the intersections of these dimensions that make communities vulnerable to catastrophes and mending them now can help ensure that these neighborhoods do not unjustly bear the brunt of future disasters. Finally, we advise that policymakers bear in mind evidence from other natural disasters that shows that federal aid and similar resources often disproportionately help the advantaged, thereby exacerbating existing race/ethnicity income disparities (Howell and Elliott, 2018; 2019). Efforts should be taken to ensure that the same does not happen in the wake of COVID-19.
The ongoing pandemic demands detailed and timely data, and the San Antonio Energy and Time Use Survey is an important tool that can help our community assess the impact of COVID-19 on households as the pandemic evolves. Because of the high rate of job loss, job recovery must be a key element for the design of upcoming labor policies. This is especially relevant for the community of Blacks, Asian, American Indian or Alaskan Native, Native Hawaiian or Other Pacific Islander, of two or more races. Attending to the recovery of employment, especially in Jefferson Heights, will help to reduce the difference with Elm Creek. 
More broadly, the local evidence also indicates that during the pandemic, economically less favored neighborhoods, as in Jefferson Heights, experience material difficulties to a greater extent than economically more favored neighborhoods, as Elm Creek.
<br>
<h1>References</h1>
<br>
1.	Aldrich, Daniel P. (2011). The power of people: social capital’s role in recovery from the 1995 Kobe earthquake. Nat Hazards 56:595-611
2.	Finch, Christina, Emrich, Christopher T, Cutter, Susan L. (2010). Disaster disparities and differential recovery in New Orleans. Popul Environ 31:179-202.
3.	Howell, Junia and Elliott, James R. (2018). As disaster costs rise, so does inequality. Socius 4:1-3
4.	Howell, Junia and Elliott, James R. (2019). Damages done: the longitudinal impacts of natural hazards on wealth inequality in the United States. Social Problems 66:448-467.










