---
title: "Economic Hardships During the COVID-19 Pandemic Require Targeted Recovery Assistance"
subtitle: |
  Findings from the San Antonio Energy and Time Use Survey
date: |
  July 2021
author: 
  - Uriel Lomelí-Carrillo^[Department of Demography, College for Health, Community and Policy]
  - Renhao Sun^[Department of Management Science and Statistics, Alvarez College of Business]
  - Marla Gutierrez^[Institute for Health Disparities Research, College for Health, Community and Policy]
  - Joel Sanchez^[Institute for Health Disparities Research, College for Health, Community and Policy]
  - Eric Shattuck^[Institute for Health Disparities Research, College for Health, Community and Policy]
  - Ying Huang^[Department of Demography, College for Health, Community and Policy]
  - Wenbo Wu^[Department of Management Science and Statistics, Alvarez College of Business]
output: 
  html_document:
    code_folding: hide
    highlight: tango
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r libs, message=FALSE, include=FALSE}
library(ggplot2)
library(ggrepel)
library(dplyr)
library(ggsci)
library(wesanderson)
library(stringr)
library(moe)
library(patchwork)
library(GGally)
```

```{r load, include=FALSE}
load(file = "~/GitHub/saetus/data_recode.RData")

data <- data %>% 
  mutate_at(vars(hardships_1:hardships_6), funs(recode(., "Yes" = as.numeric(1), "No" = as.numeric(0)))) %>% 
  mutate(hards = hardships_1 + hardships_2 + hardships_3 + hardships_4 + hardships_5 + hardships_6, 
         race_eth2 = case_when(race_eth %in% "NH-White" ~ "Non-Hispanic White",
                               race_eth %in% "Hispanic" ~ "Hispanic",
                               race_eth %in% "NH-Black" ~ "Non-Hispanic Black",
                               race_eth %in% "NH-Asian" ~ "Non-Hispanic Asian",
                               race_eth %in% c("NH-AIAN", "NH-NHPI", "NH-Other") ~ "Non-Hispanic Other"),
         race_eth3 = case_when(race_eth %in% "NH-White" ~ "Non-Hispanic White",
                               race_eth %in% "Hispanic" ~ "Hispanic",
                               race_eth %in% c("NH-Black", "NH-Asian", "NH-AIAN", "NH-NHPI", "NH-Other") ~ "Non-Hispanic Other"),
         bad = if_else(hards == 1, "One hardship", 
                       if_else(hards == 2, "Two hardships",
                               if_else(hards > 2, "More than two", NA_character_))))

data$bad <- ordered(data$bad, levels = c("One hardship", "Two hardships", "More than two"))
data$race_eth <- ordered(data$race_eth, levels = c("Hispanic", "NH-White", "NH-Black", "NH-Asian", "NH-AIAN", "NH-NHPI", "NH-Other"))
data$race_eth2 <- ordered(data$race_eth2, 
                          levels = c("Hispanic", "Non-Hispanic White", "Non-Hispanic Black", "Non-Hispanic Asian","Non-Hispanic Other"))
data$race_eth3 <- ordered(data$race_eth3, levels = c("Hispanic", "Non-Hispanic White", "Non-Hispanic Other"))
data$health <- ordered(data$health, levels = c("Excellent", "Very good", "Good", "Fair", "Poor"))
```

```{r themeu, include=FALSE, message=FALSE, warning=FALSE}
sysfonts::font_add_google(name = 'Lato', family = "foo")
showtext::showtext_auto()

themeu <- theme(legend.position = "bottom", 
                legend.text = element_text(size = 15, color = "gray40"), 
                legend.key.size = unit(.5, "cm"),
                panel.background = element_rect(colour = "black"),
                plot.title = element_text(face = "bold", size = 30, hjust = .5, vjust = .5, lineheight = .5), 
                plot.caption = element_text(size = 15),
                plot.subtitle = element_text(colour = "gray50", face = "bold", size = 22, lineheight = .5, hjust = .5, vjust = .5),
                axis.text = element_text(size = 20), 
                text = element_text(family = "foo"))

themeuf <- theme(legend.position = "top", 
                 legend.text = element_text(size = 25, color = "gray10"), 
                 legend.key.size = grid::unit(.5, "cm"), 
                 legend.title = element_text(color = "gray25", face = "bold", size = 20), 
                 panel.background = element_rect(colour = "black"),
                 plot.title = element_text(face = "bold", size = 32, hjust = .5, vjust = .5, lineheight = .5), 
                 plot.caption = element_text(size = 19),
                 plot.subtitle = element_text(colour = "gray30", face = "bold", size = 26, lineheight = .5, hjust = .5, vjust = .5),
                 axis.text = element_text(size = 27, color = "gray10", face = "bold"),
                 strip.text = element_text(size = 25), 
                 axis.title.x = element_text(color = "gray10", size = 25), 
                 axis.ticks.y = element_blank(),
                 panel.grid.major.x = element_blank(),
                 panel.grid.minor.x = element_blank(),
                 panel.grid.major.y = element_line(colour = "grey70", linetype = "dotted"),
                 plot.tag = element_text(size = 30),
                 text = element_text(family = "foo"))
```
<p>&nbsp;</p>
<p align="justify">
Ever since San Antonio confirmed its first COVID-19 case more than one year ago,^1^ the COVID-19 pandemic and the associated social and economic fallouts have upended the lives of many. Although vaccine rollouts offer hopes for a rapid economic recovery, many people are at risk of long-term economic distress. At the national level, the unemployment rate continues to be higher than before the COVID-19 pandemic.^2^ About 115 million people experienced income loss from March 2020 to February 2021.^3^ According to the Household Pulse Survey, a nationally representative data designed to measure household experiences during the COVID-19 pandemic, about 30% of Latino and Black households with children experienced three or more economic and health-related hardships during the pandemic. This is almost twice the share among Asian (13%) and White (16%) households with children.^4^  
</p>

<p align="justify">
At the local level, economic hardships are distributed unequally by racial/ethnic groups and by neighborhood characteristics. Black and Latino households were more than twice as likely as their White counterparts to report having insufficient food (16% each, compared to 6% of White households).^4^ Additionally, the number of struggling families are overrepresented in racial and ethnic minority communities.^5^  People of color account for 75.3% of the population in San Antonio, and their share continues to grow.^6^  As this demographic shift unfolds, their social and economic well-being will determine the future and prosperity of the city. In this policy brief, we use household survey data in two selected local communities to describe household economic hardships by racial/ethnic groups and across neighborhoods. 
</p>

<p align="justify">
Key findings from the analysis are 1) job loss, followed by difficulty in making rent/mortgage payment, affording food, and paying utility bills are the most experienced hardships during the pandemic, 2) while job loss varies little by neighborhood, racial and ethnic inequalities in job loss prevail regardless, and 3) residents in disadvantaged neighborhoods may face stalled employment recovery relative to their counterparts in more advantaged neighborhoods. The challenge before us now is to create the conditions that make economic security possible for all. Recovery from the COVID-19 crisis is not only about controlling the spread of a virus and getting people vaccinated; it is also about ensuring that the individuals and communities that have suffered the most can recover from this pandemic and be more resilient in the future. Low-income and minority communities need targeted outreach and assistance in implementing recovery measures.
</p>
<p>&nbsp;</p>
##### **Data**

<p align="justify">
Our analysis of the COVID-19 economic crisis in local communities is based on the San Antonio Energy and Time Use Survey. This is an online survey conducted between March 22-24, 2021 in Elm Creek (78230) and Jefferson Heights (78202). We selected Elm Creek and Jefferson Heights as our study sites because they represent different socioeconomic and demographic contexts (Table 1). The Elm Creek neighborhood (78230) is located in North-Central San Antonio, Texas, and the Jefferson Heights neighborhood (78202) is located in the east of downtown San Antonio. Residents in these two neighborhoods are exposed to drastically different socioeconomic conditions. For example, more than 90% of the residents in Elm Creek have at least a high school diploma. In contrast, less than 70% of the residents in Jefferson Heights achieved a high school diploma or equivalent. Partly driven by the large disparity in educational attainment between the two neighborhoods, the per capita annual income in 2019 in Elm Creek ($38,640) is almost two times higher than that of Jefferson Heights ($18,710). About 38% of residents in Jefferson Heights live in poverty, compared to only 13% of residents in Elm Creek. The ethnic and racial composition of the two neighborhoods also varies considerably. For instance, 39% of the residents in Elm Creek are Whites, compared to only 11% in Jefferson Heights.   
</p>
<p>&nbsp;</p>
<center>**Table 1.** Sociodemographic Characteristics of Elm Creek and Jefferson Heights</center>

---

||**Elm Creek (78230)**|**Jefferson Heights (78202)**| 
|-------------|:-------------:|:-------------:|
|**Demographic Composition**|||
|Female|52%|50%|
|Male|48%|50%|
|**Race and Ethnic Composition**|||
|Hispanic|48%|60%|
|White|39%|11%|		
|Other|13%|29%|
|**Economic Status**|||
|Per capita income|$38,640|$18,710|
|Median household income|$62,332|$28,130|
|Under $50K|42%|70%|
|$50K - $100K|29%|19%|
|$100K - $200K|21%|8%|
|Over $200K|8%|3%|
|**Poverty Rate**|||
|Persons below poverty line|13%|38%|
|Children (Under 18)|17%|58%|
|Seniors (65 and over)|7%|21%|
|<font size="1">Source: U.S. Census Bureau (2019). American Community Survey 5-year estimates. Retrieved from Census Reporter Profile.</font>|  

<p>&nbsp;</p>
<p align="justify">
The household-level questionnaire collected information on time use, energy consumption, self-reported health and usage of medical devices at home, employment situation, hardships experienced, and demographic characteristics. The study was approved by the University of Texas at San Antonio Institutional Review Board. We use Qualtrics,^7^ a survey software tool, to design, send, and collect surveys online. We distributed the survey on March 22, 2021, and between March 22 to March 24, we collected surveys from 1,022 respondents. In the analysis, we excluded 63 respondents from other zip codes and an additional 154 respondents due to lack of information and inconsistencies with their response time. The final sample consists of 805 respondents in total, of whom 479 are from Elm Creek and 326 are from Jefferson Heights.&nbsp  
</p>

<p align="justify">
In the next section, we present key findings related to the employment situation and material hardships by race/ethnic groups, including Hispanics, non-Hispanic Whites, and non-Hispanic Others (including Asians, Blacks, and other race and ethnic groups). We also present the key findings by neighborhood, including a more advantaged neighborhood -Elm Creek- and a more disadvantaged neighborhood- Jefferson Heights. We use brown circles to represent Elm Creek and dark blue circles to represent Jefferson Heights. The size of the circle is proportional to the number of respondents in each racial and ethnic group.&nbsp  
</p>
<p>&nbsp;</p>
##### **Key Findings**  

**1) Job loss by race and ethnicity and by neighborhood**

<p align="justify">
*The economic fallout in job loss varies little by neighborhood, but racial inequalities prevail regardless. Almost half of Hispanic households experienced job loss, in comparison to a third of non-Hispanic White households.*
</p>
<p align="justify">
Figure 1 shows the percentage of respondents who experienced job loss since March 2020. These data are collected with the question, *“Since the onset of COVID-19 (March 2020), have you or has anyone in your household experienced any of the following hardships?”* Very similar percentage of Hispanics, about 49% in both neighborhoods, reported experiencing job loss during the pandemic, in comparison to 35.7% and 39.4% of non-Hispanic Whites in respective neighborhoods. Although job loss varies little by neighborhood, the rates of job loss among non-Hispanic Others are considerably lower than Hispanics and Whites, 12.0% in Elm Creek and 15.8% in Jefferson Heights. 
</p>
<p>&nbsp;</p>
<center>**Figure 1.** Percentage of People Experienced Job Loss by Race and Ethnicity, and by Neighborhood</center>
```{r moe_frontline, include=FALSE, message=FALSE, warning=FALSE}
#devtools::install_github("peterdalle/moe")
data.ec <- data %>% 
  filter(zipcode == "Elm Creek" & !is.na(frontline))

data.jh <- data %>% 
  filter(zipcode == "Jefferson Heights" & !is.na(frontline))

nec <- 230 + 171 + 64
njh <- 145 + 142 + 32

frontline.prop.ec <- prop.table(table(data.ec$frontline, data.ec$race_eth3), 2)
frontline.prop.jh <- prop.table(table(data.jh$frontline, data.jh$race_eth3), 2)

frontline_pct_ec <- c(0.4782609, 0.3236994, 0.1538462)
frontline_pct_jh <- c(0.5342466, 0.4100719, 0.3636364)

frontline_ec_moe <- sapply(frontline_pct_ec, FUN = moe, n = nec, population.correction = T, population.size = 18223)
frontline_jh_moe <- sapply(frontline_pct_jh, FUN = moe, n = njh, population.correction = T, population.size = 3812)

lower1 <- round(frontline_ec_moe[, 1]$conf.lower/100, 2)
upper1 <- round(frontline_ec_moe[, 1]$conf.upper/100, 2)

lower2 <- round(frontline_ec_moe[, 2]$conf.lower/100, 2)
upper2 <- round(frontline_ec_moe[, 2]$conf.upper/100, 2)

lower3 <- round(frontline_ec_moe[, 3]$conf.lower/100, 2)
upper3 <- round(frontline_ec_moe[, 3]$conf.upper/100, 2)

lower1b <- round(frontline_jh_moe[, 1]$conf.lower/100, 2)
upper1b <- round(frontline_jh_moe[, 1]$conf.upper/100, 2)

lower2b <- round(frontline_jh_moe[, 2]$conf.lower/100, 2)
upper2b <- round(frontline_jh_moe[, 2]$conf.upper/100, 2)

lower3b <- round(frontline_jh_moe[, 3]$conf.lower/100, 2)
upper3b <- round(frontline_jh_moe[, 3]$conf.upper/100, 2)
```
```{r moe_unemployed, include=FALSE, message=FALSE, warning=FALSE}
data <- data %>%
  mutate_at(vars(emp_status), ~if_else(. %in% c("Work for pay at a job","Temporarily absent from job"), "employed",
                                    if_else(. %in% c("Layoff from a job","Actively looking for a job"), "unemployed",
                                            if_else(. %in% c("Retired", "Unable to work"), "retired", "NA"))))
data.ec.unemp <- data %>% 
  filter(emp_status != "NA", zipcode == "Elm Creek")

data.jh.unemp <- data %>% 
  filter(emp_status != "NA", zipcode == "Jefferson Heights")

nec.unemp <- 230 + 171 + 64
njh.unemp <- 145 + 142 + 32

unemp.prop.ec <- prop.table(table(data.ec.unemp$emp_status, data.ec.unemp$race_eth3), 2)
unemp.prop.jh <- prop.table(table(data.jh.unemp$emp_status, data.jh.unemp$race_eth3), 2)

unemp_pct_ec <- c(0.14347826, 0.14619883, 0.20312500)
unemp_pct_jh <- c(0.10344828, 0.18309859, 0.37500000)

unemp_ec_moe <- sapply(unemp_pct_ec, FUN = moe, n = nec.unemp, population.correction = T, population.size = 18223)
unemp_jh_moe <- sapply(unemp_pct_jh, FUN = moe, n = njh.unemp, population.correction = T, population.size = 3812)

lower1u <- round(unemp_ec_moe[, 1]$conf.lower/100, 2)
upper1u <- round(unemp_ec_moe[, 1]$conf.upper/100, 2)

lower2u <- round(unemp_ec_moe[, 2]$conf.lower/100, 2)
upper2u <- round(unemp_ec_moe[, 2]$conf.upper/100, 2)

lower3u <- round(unemp_ec_moe[, 3]$conf.lower/100, 2)
upper3u <- round(unemp_ec_moe[, 3]$conf.upper/100, 2)

lower1bu <- round(unemp_jh_moe[, 1]$conf.lower/100, 2)
upper1bu <- round(unemp_jh_moe[, 1]$conf.upper/100, 2)

lower2bu <- round(unemp_jh_moe[, 2]$conf.lower/100, 2)
upper2bu <- round(unemp_jh_moe[, 2]$conf.upper/100, 2)

lower3bu <- round(unemp_jh_moe[, 3]$conf.lower/100, 2)
upper3bu <- round(unemp_jh_moe[, 3]$conf.upper/100, 2)
```
```{r moe_loss, include=FALSE, message=FALSE, warning=FALSE}
loss <- data %>%
  filter(hardships_1 == 1, emp_status != "retired", emp_status != "NA") %>% 
  group_by(zipcode, race_eth3) %>%
  summarize(n = n()) %>% 
  mutate(pct = n/sum(n),
         lbl = scales::percent(pct, accuracy = 0.1)) 

loss.ec <- loss %>% filter(zipcode == "Elm Creek")
loss.jh <- loss %>% filter(zipcode == "Jefferson Heights")

nec.loss <- sum(loss.ec$n)
njh.loss <- sum(loss.jh$n)

loss_ec_moe <- sapply(loss.ec$pct, FUN = moe, n = nec.loss, population.correction = T, population.size = 18223)
loss_jh_moe <- sapply(loss.jh$pct, FUN = moe, n = njh.loss, population.correction = T, population.size = 3812)

lower1u <- round(loss_ec_moe[, 1]$conf.lower/100, 2)
upper1u <- round(loss_ec_moe[, 1]$conf.upper/100, 2)

lower2u <- round(loss_ec_moe[, 2]$conf.lower/100, 2)
upper2u <- round(loss_ec_moe[, 2]$conf.upper/100, 2)

lower3u <- round(loss_ec_moe[, 3]$conf.lower/100, 2)
upper3u <- round(loss_ec_moe[, 3]$conf.upper/100, 2)

lower1bu <- round(loss_jh_moe[, 1]$conf.lower/100, 2)
upper1bu <- round(loss_jh_moe[, 1]$conf.upper/100, 2)

lower2bu <- round(loss_jh_moe[, 2]$conf.lower/100, 2)
upper2bu <- round(loss_jh_moe[, 2]$conf.upper/100, 2)

lower3bu <- round(loss_jh_moe[, 3]$conf.lower/100, 2)
upper3bu <- round(loss_jh_moe[, 3]$conf.upper/100, 2)

loss$lower <- c(lower1u, lower2u, lower3u, lower1bu, lower2bu, lower3bu)
loss$upper <- c(upper1u, upper2u, upper3u, upper1bu, upper2bu, upper3bu)
```
```{r moe_welfare, include=FALSE, message=FALSE, warning=FALSE}
welfare <- data %>%
  mutate_at(vars(welfare_1:welfare_7), ~if_else(. == "Yes", 1, 0))

welfare$total_welfare <- rowSums(welfare[, c("welfare_1","welfare_2","welfare_3","welfare_4","welfare_5","welfare_6","welfare_7")],
                                 na.rm = TRUE)
welfare <- welfare %>%
  filter(!is.na(welfare_1)&!is.na(welfare_2)&!is.na(welfare_3)&
           !is.na(welfare_4)&!is.na(welfare_5)&!is.na(welfare_6)&!is.na(welfare_7)) %>% 
  group_by(zipcode, race_eth3) %>%
  dplyr::summarize(n = n(),
            average_welfare = round(mean(total_welfare), 2),
            std.er.welfare = round(sd(total_welfare)/sqrt(length(total_welfare)), 2),
            crit.value = qt(0.975, df = length(total_welfare)-1),
            moe = crit.value*std.er.welfare,
            lower.welfare.ec = round(average_welfare - moe, 2),
            upper.welfare.ec = round(average_welfare + moe, 2))

welfare.ec <- c(1.77, 1.79, 1.63)
welfare.jh <- c(1.84, 1.86, 1.81)

t.test(welfare$average_welfare ~ welfare$zipcode)
summary(aov(formula = average_welfare ~ zipcode+race_eth3, data = welfare))
```
```{r moe_hardships, include=FALSE, message=FALSE, warning=FALSE}
loss.1 <- data %>% 
  filter(!is.na(hardships_1)) %>% 
  rename(hardships = hardships_1) %>% 
  group_by(zipcode, hardships) %>%
  summarize(n = n()) %>% 
  mutate(pct = n/sum(n),
         lbl = scales::percent(pct, accuracy = 0.1),
         hardships = if_else(hardships == 1, "Job loss", 
                               if_else(hardships == 0, "No difficulty", "NA"))) 

loss.2 <- data %>% 
  filter(!is.na(hardships_2)) %>% 
  rename(hardships = hardships_2) %>% 
  group_by(zipcode, hardships) %>%
  summarize(n = n()) %>% 
  mutate(pct = n/sum(n),
         lbl = scales::percent(pct, accuracy = 0.1),
         hardships = if_else(hardships == 1, "Paying utility bills", 
                               if_else(hardships == 0, "No difficulty", "NA")))  

loss.3 <- data %>% 
  filter(!is.na(hardships_3)) %>% 
  rename(hardships = hardships_3) %>% 
  group_by(zipcode, hardships) %>%
  summarize(n = n()) %>% 
  mutate(pct = n/sum(n),
         lbl = scales::percent(pct, accuracy = 0.1),
         hardships = if_else(hardships == 1, "Affording foods", 
                               if_else(hardships == 0, "No difficulty", "NA")))  

loss.4 <- data %>% 
  filter(!is.na(hardships_4)) %>% 
  rename(hardships = hardships_4) %>% 
  group_by(zipcode, hardships) %>%
  summarize(n = n()) %>% 
  mutate(pct = n/sum(n),
         lbl = scales::percent(pct, accuracy = 0.1),
         hardships = if_else(hardships == 1, "Paying rent/mortgage", 
                               if_else(hardships == 0, "No difficulty", "NA")))  

loss.5 <- data %>% 
  filter(!is.na(hardships_5)) %>% 
  rename(hardships = hardships_5) %>% 
  group_by(zipcode, hardships) %>%
  summarize(n = n()) %>% 
  mutate(pct = n/sum(n),
         lbl = scales::percent(pct, accuracy = 0.1),
         hardships = if_else(hardships == 1, "Paying medical bills", 
                               if_else(hardships == 0, "No difficulty", "NA")))  

loss.6 <- data %>% 
  filter(!is.na(hardships_6)) %>% 
  rename(hardships = hardships_6) %>% 
  group_by(zipcode, hardships) %>%
  summarize(n = n()) %>% 
  mutate(pct = n/sum(n),
         lbl = scales::percent(pct, accuracy = 0.1),
         hardships = if_else(hardships == 1, "Delay getting medical care", 
                               if_else(hardships == 0, "No difficulty", "NA")))  

hardships <- rbind(loss.1, loss.2, loss.3, loss.4, loss.5, loss.6)

hardships.ec <- hardships %>% 
  filter(zipcode == "Elm Creek", hardships != "No difficulty") %>% arrange(zipcode)

hardships.jh <- hardships %>% 
  filter(zipcode == "Jefferson Heights", hardships != "No difficulty") %>% arrange(zipcode)

hardships_pct_ec <- c(0.65484634, 0.20803783, 0.25059102, 0.26950355, 0.17494090, 0.08510638)
hardships_pct_jh <- c(0.6583630, 0.2206406, 0.2953737, 0.3202847, 0.1886121, 0.1281139)

hardships_ec_moe <- sapply(hardships_pct_ec, FUN = moe, n = 423, population.correction = T, population.size = 18223)
hardships_jh_moe <- sapply(hardships_pct_jh, FUN = moe, n = 281, population.correction = T, population.size = 3812)

lower1 <- round(hardships_ec_moe[, 1]$conf.lower/100, 2)
upper1 <- round(hardships_ec_moe[, 1]$conf.upper/100, 2)

lower2 <- round(hardships_ec_moe[, 2]$conf.lower/100, 2)
upper2 <- round(hardships_ec_moe[, 2]$conf.upper/100, 2)

lower3 <- round(hardships_ec_moe[, 3]$conf.lower/100, 2)
upper3 <- round(hardships_ec_moe[, 3]$conf.upper/100, 2)

lower4 <- round(hardships_ec_moe[, 4]$conf.lower/100, 2)
upper4 <- round(hardships_ec_moe[, 4]$conf.upper/100, 2)

lower5 <- round(hardships_ec_moe[, 5]$conf.lower/100, 2)
upper5 <- round(hardships_ec_moe[, 5]$conf.upper/100, 2)

lower6 <- round(hardships_ec_moe[, 6]$conf.lower/100, 2)
upper6 <- round(hardships_ec_moe[, 6]$conf.upper/100, 2)

lower1b <- round(hardships_jh_moe[, 1]$conf.lower/100, 2)
upper1b <- round(hardships_jh_moe[, 1]$conf.upper/100, 2)

lower2b <- round(hardships_jh_moe[, 2]$conf.lower/100, 2)
upper2b <- round(hardships_jh_moe[, 2]$conf.upper/100, 2)

lower3b <- round(hardships_jh_moe[, 3]$conf.lower/100, 2)
upper3b <- round(hardships_jh_moe[, 3]$conf.upper/100, 2)

lower4b <- round(hardships_jh_moe[, 4]$conf.lower/100, 2)
upper4b <- round(hardships_jh_moe[, 4]$conf.upper/100, 2)

lower5b <- round(hardships_jh_moe[, 5]$conf.lower/100, 2)
upper5b <- round(hardships_jh_moe[, 5]$conf.upper/100, 2)

lower6b <- round(hardships_jh_moe[, 6]$conf.lower/100, 2)
upper6b <- round(hardships_jh_moe[, 6]$conf.upper/100, 2)
```
```{r moe_bad, include=FALSE, message=FALSE, warning=FALSE}
bad <- data %>%
  filter(!is.na(bad)) %>% 
  group_by(zipcode, bad) %>%
  summarize(n = n()) %>% 
  mutate(pct = n/sum(n),
         lbl = scales::percent(pct, accuracy = 0.1))

bad.ec <- bad %>% filter(zipcode == "Elm Creek")
bad.jh <- bad %>% filter(zipcode == "Jefferson Heights")

nec.bad <- sum(bad.ec$n)
njh.bad <- sum(bad.jh$n)

bad_ec_moe <- sapply(bad.ec$pct, FUN = moe, n = nec.bad, population.correction = T, population.size = 18223)
bad_jh_moe <- sapply(bad.jh$pct, FUN = moe, n = njh.bad, population.correction = T, population.size = 3812)

lower1bad <- round(bad_ec_moe[, 1]$conf.lower/100, 2)
upper1bad <- round(bad_ec_moe[, 1]$conf.upper/100, 2)

lower2bad <- round(bad_ec_moe[, 2]$conf.lower/100, 2)
upper2bad <- round(bad_ec_moe[, 2]$conf.upper/100, 2)

lower3bad <- round(bad_ec_moe[, 3]$conf.lower/100, 2)
upper3bad <- round(bad_ec_moe[, 3]$conf.upper/100, 2)

lower1bbad <- round(bad_jh_moe[, 1]$conf.lower/100, 2)
upper1bbad <- round(bad_jh_moe[, 1]$conf.upper/100, 2)

lower2bbad <- round(bad_jh_moe[, 2]$conf.lower/100, 2)
upper2bbad <- round(bad_jh_moe[, 2]$conf.upper/100, 2)

lower3bbad <- round(bad_jh_moe[, 3]$conf.lower/100, 2)
upper3bbad <- round(bad_jh_moe[, 3]$conf.upper/100, 2)

bad$lower <- c(lower1bad, lower2bad, lower3bad, lower1bbad, lower2bbad, lower3bbad)
bad$upper <- c(upper1bad, upper2bad, upper3bad, upper1bbad, upper2bbad, upper3bbad)
```

```{r frontline_plot, message=FALSE, warning=FALSE, include=FALSE}
frontline <- NULL
total <- NULL
frontline_pct <- NULL

total <- data %>%
  filter(!is.na(frontline)) %>% 
  group_by(zipcode, race_eth3) %>%
  summarize(n = n())

frontline <- data %>%
  filter(frontline == "Yes") %>%
  group_by(zipcode, race_eth3) %>%
  summarize(frontline_n = n())

frontline_pct <- data.frame(total[,"zipcode"], total[,"race_eth3"], total[,"n"], frontline[,"frontline_n"])

frontline_pct <- frontline_pct %>%
  mutate(pct = frontline_n/n,
               lbl = scales::percent(pct, accuracy = 0.1))

frontline_pct$lower <- c(lower1, lower2, lower3, lower1b, lower2b, lower3b)
frontline_pct$upper <- c(upper1, upper2, upper3, upper1b, upper2b, upper3b)

frontline_pct %>%
  ggplot(aes(x = pct, y = reorder(race_eth3, pct), color = zipcode)) + 
  geom_errorbar(aes(xmin = lower, xmax = upper), show.legend = F, width = 0.15) +
  geom_point(aes(size = n)) +
  geom_text_repel(aes(label = lbl), size = 8, color = "gray10", segment.alpha = 0, family = "foo", nudge_y = .3, nudge_x = .01) +
  scale_x_continuous(limits = c(0, .6), breaks = seq(0, 1, .15), label = scales::percent) +
  scale_color_manual(values = wes_palette("Darjeeling2", n = 3)) +
  guides(color = guide_legend(label.position = "left", label.vjust = 0.5, label.hjust = 1, override.aes = list(size = 5)),
         size = F) +
  labs(y = NULL, x = NULL, color = NULL,
       title = "Figure 1. Frontline workers by race and ethnicity", 
       subtitle = str_wrap("Are you a frontline worker?"),
       caption = "Source: 2021 San Antonio Energy and Time Use Survey") +
  theme_minimal() +
  themeuf

#ggsave(filename = "figure_1.png", plot = last_plot(), path = "~/GitHub/saetus/", width = 6, height = 4.5, units = "in", dpi = "print")
```

```{r unemp_plot, warning=FALSE, message=FALSE, include=FALSE}
total <- data %>%
  filter(emp_status != "NA") %>%
  group_by(zipcode, race_eth3) %>%
  summarize(n = n())

unemployed <- data %>%
  filter(emp_status == "unemployed") %>%
  group_by(zipcode, race_eth3) %>%
  summarize(unemployed_n = n())

unemployed <- data.frame(unemployed)

colnames(unemployed) <- c("zipcode","race_eth3","unemployed_n")

unemployed <- unemployed[with(unemployed, order(zipcode, race_eth3)),] 

unemployed_pct <- data.frame(total[,"zipcode"], total[,"race_eth3"], total[,"n"], unemployed[,"unemployed_n"])

colnames(unemployed_pct) <- c("zipcode","race_eth3","n","unemployed_n")

unemployed_pct$unemployed_n <- as.numeric(unemployed_pct$unemployed_n)

unemployed_pct <- unemployed_pct %>%
        mutate(pct = unemployed_n/n,
               lbl = scales::percent(pct, accuracy = 0.1))

unemployed_pct$lower <- c(lower1u, lower2u, lower3u, lower1bu, lower2bu, lower3bu)
unemployed_pct$upper <- c(upper1u, upper2u, upper3u, upper1bu, upper2bu, upper3bu)

fig2 <- unemployed_pct %>%
  ggplot(aes(x = pct, y = reorder(race_eth3, -pct), color = zipcode)) + 
  geom_errorbar(aes(xmin = lower, xmax = upper), show.legend = F, width = 0.1) +
  geom_point(aes(size = n)) +
  geom_text_repel(aes(label = lbl), size = 7, color = "gray10", segment.alpha = 0, family = "foo", nudge_y = .3, nudge_x = .01) +
  scale_x_continuous(limits = c(0, .45), breaks = seq(0, 1, .15), label = scales::percent) +
  scale_color_manual(values = wes_palette("Darjeeling2", n = 3)) +
  guides(color = guide_legend(label.position = "left", label.vjust = 0.5, label.hjust = 1, override.aes = list(size = 5)), 
         size = F) +
  labs(y = NULL, x = NULL, color = NULL, 
       subtitle = "A) Unemployment by race and ethnicity") +
  theme_classic() +
  themeuf + theme(legend.position = "bottom") 

#ggsave(filename = "figure_2.png", plot = last_plot(), path = "~/GitHub/saetus/", width = 6, height = 4.5, units = "in", dpi = "print")
```

```{r loss_income_plot, warning=FALSE, message=FALSE}
fig3 <- loss %>% 
  ggplot(aes(x = pct, y = reorder(race_eth3, pct), color = zipcode)) +
  geom_errorbar(aes(xmin = lower, xmax = upper), show.legend = F, width = 0.1) +
  geom_point(stat = "identity", aes(size = n)) +
  geom_text_repel(aes(label = lbl), size = 8, color = "gray10", segment.alpha = 0, family = "foo", nudge_y = .25, nudge_x = .01) +
  scale_x_continuous(limits = c(0, .6), breaks = seq(0, 1, .15), label = scales::percent) +
  scale_color_manual(values = wes_palette("Darjeeling2", n = 3)) +
  guides(color = guide_legend(label.position = "left", label.vjust = 0.5, label.hjust = 1, override.aes = list(size = 5)),
         size = FALSE) +
  labs(y = NULL, x = NULL, color = NULL, size = NULL,
       title = NULL,
       subtitle = NULL,
       caption = NULL) +
  theme_minimal() +
  themeuf + theme(legend.position = "bottom")

fig3

ggsave(filename = "figure_1_new.png", plot = fig3, path = "~/GitHub/saetus/", width = 6, height = 4.5, units = "in", dpi = "print")

# new.fig2 <- fig2 + fig3 + 
#   plot_annotation(title = "Figure 1. Job loss experienced by neighborhood and by race and ethnicity",
#                                           caption = "Source: 2021 San Antonio Energy and Time Use Survey", 
#                                           theme = themeuf) +
#   plot_layout(guides = "collect") & theme(legend.position = "bottom")
# 
# ggsave(filename = "figure_new_2.png", plot = last_plot(), path = "~/GitHub/saetus/",
#        width = 6, height = 4.5, units = "in", dpi = "print")
```

<p>&nbsp;</p>
**2) Material hardships by race and ethnicity and by neighborhood**
<p align="justify">
*A considerable portion of households face challenges meeting their basic needs, such as making payments to mortgage/rent and utility bills. Hispanic families are much more likely than their White counterparts to experience all types of hardships in both neighborhoods.*
</p>

<p align="justify">
Material hardship is defined as going without basic needs such as food, medical care, housing, or utilities due to inadequate income. We use several indicators to capture the prevalence of material hardship since the pandemic, including difficulty in making the next rent or mortgage payment, in affording sufficient food, in paying utility bills, and in paying medical bills, as well as delaying needed medical care or prescription medication because of cost. Since the start of the pandemic, the most experienced hardship in both neighborhoods has been having trouble paying rent or mortgage. As with job loss (Figure 1), Figure 2 demonstrates that there are no significant differences in the prevalence of hardships between residents in Jefferson Heights and Elm Creek as indicated by the overlapping margins of error. Roughly a third of respondents (and their families) in Elm Creek and in Jefferson Heights experienced difficulty in making rent/mortgage payments since the start of the COVID-19 pandemic. The least prevalent hardship experienced among residents of both neighborhoods was delayed needed medical care or prescription medication, 9% and 13% of respondents in Elm Creek and Jefferson Heights, respectively.
</p>
<p>&nbsp;</p>
<center>**Figure 2.** Percentage of People Who Experienced Types of Material Hardship, by Neighborhood</center>
```{r hardships_plots, message=FALSE, include=FALSE}
hardships <- hardships %>% filter(hardships != "No difficulty") %>%  arrange(zipcode)

hardships$lower <- c(lower1, lower2, lower3, lower4, lower5, lower6, lower1b, lower2b, lower3b, lower4b, lower5b, lower6b)  
hardships$upper <- c(upper1, upper2, upper3, upper4, upper5, upper6, upper1b, upper2b, upper3b, upper4b, upper5b, upper6b)  

# hardships %>% 
#   filter(hardships != "Job loss") %>% 
#   ggplot(aes(x = pct, y = reorder(hardships, pct), color = zipcode)) +
#   geom_errorbar(aes(xmin = lower, xmax = upper), show.legend = F, width = 0.15) +
#   geom_point(stat = "identity", aes(size = n)) +
#   geom_text_repel(aes(label = lbl), size = 7, color = "gray10", segment.alpha = 0, family = "foo", nudge_y = .3) +
#   scale_x_continuous(limits = c(0, .45), breaks = seq(0, 1, .15), label = scales::percent) +
#   scale_color_manual(values = wes_palette("Darjeeling2", n = 3)) +
#   guides(color = guide_legend(label.position = "left", label.vjust = 0.5, label.hjust = 1, override.aes = list(size = 5)), 
#          size = F) +
#   labs(y = NULL, x = NULL, color = NULL,
#        title = "Figure 5. Material hardships experienced by zip code", 
#        subtitle = str_wrap("Since the onset of COVID-19 (March 2020), have you, or has anyone in your household experienced any of the following material hardships"),
#        caption = "Source: 2021 San Antonio Energy and Time Use Survey") +
#   theme_classic() +
#   themeuf

#ggsave(filename = "figure_5.png", plot = last_plot(), path = "~/GitHub/saetus/", width = 6, height = 4.5, units = "in", dpi = "print")

fig5 <- hardships %>% 
  filter(hardships != "Job loss") %>%
  ggplot(aes(x = pct, y = reorder(hardships, pct), color = zipcode)) +
  geom_errorbar(aes(xmin = lower, xmax = upper), show.legend = F, width = 0.1) +
  geom_point(stat = "identity", aes(size = n)) +
  geom_text_repel(aes(label = lbl), size = 8, color = "gray10", segment.alpha = 0, family = "foo", nudge_y = .2, nudge_x = .02) +
  scale_x_continuous(limits = c(0, .45), breaks = seq(0, 1, 0.15), label = scales::percent) +
  scale_color_manual(values = wes_palette("Darjeeling2", n = 3)) +
  guides(color = guide_legend(label.position = "left", label.vjust = 0.5, label.hjust = 1, override.aes = list(size = 5)), 
         size = F) +
  labs(y = NULL, x = NULL, color = NULL,
       caption = NULL,
       title = NULL,
       subtitle = NULL) +
  theme_minimal() +
  themeuf + theme(legend.position = "bottom", plot.subtitle = element_text(hjust = 0.5))

ggsave(filename = "figure_2_new.png", plot = fig5, path = "~/GitHub/saetus/", width = 6, height = 4.5, units = "in", dpi = "print")

# fig6 <- bad %>%
#   ggplot(aes(x = pct, y = reorder(bad, pct), color = zipcode)) +
#   geom_errorbar(aes(xmin = lower, xmax = upper), show.legend = F, width = 0.1) +
#   geom_point(stat = "identity", aes(size = n)) +
#   geom_text_repel(aes(label = lbl), size = 7, color = "gray10", segment.alpha = 0, family = "foo", nudge_y = .2, nudge_x = .02) +
#   scale_x_continuous(limits = c(0, .7), breaks = seq(0, 1, .15), label = scales::percent) +
#   scale_color_manual(values = wes_palette("Darjeeling2", n = 3)) +
#   guides(color = guide_legend(label.position = "left", label.vjust = 0.5, label.hjust = 1, override.aes = list(size = 5)), 
#          size = F) +
#   labs(y = NULL, x = NULL, color = NULL,
#        subtitle = str_wrap("B) Number of hardships")) +
#   theme_classic() +
#   themeuf + theme(legend.position = "bottom", plot.subtitle = element_text(hjust = 0))
# 
# ggsave(filename = "figure_7.png", plot = last_plot(), path = "~/GitHub/saetus/", width = 6, height = 4.5, units = "in", dpi = "print")
# 
# new.fig4 <- fig5 / fig6 + 
#   plot_annotation(title = "Figure 4. Material hardships experienced by zip code",
#                                           caption = "Source: 2021 San Antonio Energy and Time Use Survey", 
#                                           theme = themeuf) +
#   plot_layout(guides = "collect") & theme(legend.position = "bottom")
# 
# ggsave(filename = "figure_new_4.png", plot = last_plot(), path = "~/GitHub/saetus/", 
#        width = 6, height = 8, units = "in", dpi = "print")
```

```{r, include=FALSE, message=FALSE, include=FALSE}
loss.1r <- data %>% 
  filter(!is.na(hardships_1)) %>% 
  rename(hardships = hardships_1) %>% 
  group_by(zipcode, hardships, race_eth3) %>%
  summarize(n = n()) %>% 
  mutate(pct = n/sum(n),
         lbl = scales::percent(pct, accuracy = 0.1),
         hardships = if_else(hardships == 1, "Job loss", 
                               if_else(hardships == 0, "No difficulty", "NA"))) 

loss.2r <- data %>% 
  filter(!is.na(hardships_2)) %>% 
  rename(hardships = hardships_2) %>% 
  group_by(zipcode, hardships, race_eth3) %>%
  summarize(n = n()) %>% 
  mutate(pct = n/sum(n),
         lbl = scales::percent(pct, accuracy = 0.1),
         hardships = if_else(hardships == 1, "Paying utility bills", 
                               if_else(hardships == 0, "No difficulty", "NA")))  

loss.3r <- data %>% 
  filter(!is.na(hardships_3)) %>% 
  rename(hardships = hardships_3) %>% 
  group_by(zipcode, hardships, race_eth3) %>%
  summarize(n = n()) %>% 
  mutate(pct = n/sum(n),
         lbl = scales::percent(pct, accuracy = 0.1),
         hardships = if_else(hardships == 1, "Affording food", 
                               if_else(hardships == 0, "No difficulty", "NA")))  

loss.4r <- data %>% 
  filter(!is.na(hardships_4)) %>% 
  rename(hardships = hardships_4) %>% 
  group_by(zipcode, hardships, race_eth3) %>%
  summarize(n = n()) %>% 
  mutate(pct = n/sum(n),
         lbl = scales::percent(pct, accuracy = 0.1),
         hardships = if_else(hardships == 1, "Paying rent/mortgage", 
                               if_else(hardships == 0, "No difficulty", "NA")))  

loss.5r <- data %>% 
  filter(!is.na(hardships_5)) %>% 
  rename(hardships = hardships_5) %>% 
  group_by(zipcode, hardships, race_eth3) %>%
  summarize(n = n()) %>% 
  mutate(pct = n/sum(n),
         lbl = scales::percent(pct, accuracy = 0.1),
         hardships = if_else(hardships == 1, "Paying medical bills", 
                               if_else(hardships == 0, "No difficulty", "NA")))  

loss.6r <- data %>% 
  filter(!is.na(hardships_6)) %>% 
  rename(hardships = hardships_6) %>% 
  group_by(zipcode, hardships, race_eth3) %>%
  summarize(n = n()) %>% 
  mutate(pct = n/sum(n),
         lbl = scales::percent(pct, accuracy = 0.1),
         hardships = if_else(hardships == 1, "Delay getting medical care", 
                               if_else(hardships == 0, "No difficulty", "NA")))  

hardships.r <- rbind(loss.1r, loss.2r, loss.3r, loss.4r, loss.5r, loss.6r)
```

```{r moe_race_hards, message=FALSE, warning=FALSE, include=FALSE}
hardships.r.ec <- hardships.r %>% filter(zipcode == "Elm Creek", hardships != "No difficulty") %>% arrange(zipcode)
hardships.r.jh <- hardships.r %>% filter(zipcode == "Jefferson Heights", hardships != "No difficulty") %>% arrange(zipcode)

hardships_pct_ec_r <- c(0.49097473, 0.35740072, 0.15162455, 0.46590909, 0.26136364, 0.27272727, 0.52830189, 0.33018868, 0.14150943,
                        0.58771930, 0.37719298, 0.03508772, 0.54054054, 0.37837838, 0.08108108, 0.41666667, 0.41666667, 0.16666667)
hardships_pct_jh_r <- c(0.48108108, 0.39459459, 0.12432432, 0.50000000, 0.40322581, 0.09677419, 0.43373494, 0.43373494, 0.13253012,
                        0.56666667, 0.31111111, 0.12222222, 0.50943396, 0.37735849, 0.11320755, 0.41666667, 0.52777778, 0.05555556)

hardships_ec_r_moe <- sapply(hardships_pct_ec_r, FUN = moe, n = 423, population.correction = T, population.size = 18223)
hardships_jh_r_moe <- sapply(hardships_pct_jh_r, FUN = moe, n = 281, population.correction = T, population.size = 3812)

lower1r <- round(hardships_ec_r_moe[, 1]$conf.lower/100, 2)
upper1r <- round(hardships_ec_r_moe[, 1]$conf.upper/100, 2)

lower2r <- round(hardships_ec_r_moe[, 2]$conf.lower/100, 2)
upper2r <- round(hardships_ec_r_moe[, 2]$conf.upper/100, 2)

lower3r <- round(hardships_ec_r_moe[, 3]$conf.lower/100, 2)
upper3r <- round(hardships_ec_r_moe[, 3]$conf.upper/100, 2)

lower4r <- round(hardships_ec_r_moe[, 4]$conf.lower/100, 2)
upper4r <- round(hardships_ec_r_moe[, 4]$conf.upper/100, 2)

lower5r <- round(hardships_ec_r_moe[, 5]$conf.lower/100, 2)
upper5r <- round(hardships_ec_r_moe[, 5]$conf.upper/100, 2)

lower6r <- round(hardships_ec_r_moe[, 6]$conf.lower/100, 2)
upper6r <- round(hardships_ec_r_moe[, 6]$conf.upper/100, 2)

lower7r <- round(hardships_ec_r_moe[, 7]$conf.lower/100, 2)
upper7r <- round(hardships_ec_r_moe[, 7]$conf.upper/100, 2)

lower8r <- round(hardships_ec_r_moe[, 8]$conf.lower/100, 2)
upper8r <- round(hardships_ec_r_moe[, 8]$conf.upper/100, 2)

lower9r <- round(hardships_ec_r_moe[, 9]$conf.lower/100, 2)
upper9r <- round(hardships_ec_r_moe[, 9]$conf.upper/100, 2)

lower10r <- round(hardships_ec_r_moe[, 10]$conf.lower/100, 2)
upper10r <- round(hardships_ec_r_moe[, 10]$conf.upper/100, 2)

lower11r <- round(hardships_ec_r_moe[, 11]$conf.lower/100, 2)
upper11r <- round(hardships_ec_r_moe[, 11]$conf.upper/100, 2)

lower12r <- round(hardships_ec_r_moe[, 12]$conf.lower/100, 2)
upper12r <- round(hardships_ec_r_moe[, 12]$conf.upper/100, 2)

lower13r <- round(hardships_ec_r_moe[, 13]$conf.lower/100, 2)
upper13r <- round(hardships_ec_r_moe[, 13]$conf.upper/100, 2)

lower14r <- round(hardships_ec_r_moe[, 14]$conf.lower/100, 2)
upper14r <- round(hardships_ec_r_moe[, 14]$conf.upper/100, 2)

lower15r <- round(hardships_ec_r_moe[, 15]$conf.lower/100, 2)
upper15r <- round(hardships_ec_r_moe[, 15]$conf.upper/100, 2)

lower16r <- round(hardships_ec_r_moe[, 16]$conf.lower/100, 2)
upper16r <- round(hardships_ec_r_moe[, 16]$conf.upper/100, 2)

lower17r <- round(hardships_ec_r_moe[, 17]$conf.lower/100, 2)
upper17r <- round(hardships_ec_r_moe[, 17]$conf.upper/100, 2)

lower18r <- round(hardships_ec_r_moe[, 18]$conf.lower/100, 2)
upper18r <- round(hardships_ec_r_moe[, 18]$conf.upper/100, 2)

lower1br <- round(hardships_jh_r_moe[, 1]$conf.lower/100, 2)
upper1br <- round(hardships_jh_r_moe[, 1]$conf.upper/100, 2)

lower2br <- round(hardships_jh_r_moe[, 2]$conf.lower/100, 2)
upper2br <- round(hardships_jh_r_moe[, 2]$conf.upper/100, 2)

lower3br <- round(hardships_jh_r_moe[, 3]$conf.lower/100, 2)
upper3br <- round(hardships_jh_r_moe[, 3]$conf.upper/100, 2)

lower4br <- round(hardships_jh_r_moe[, 4]$conf.lower/100, 2)
upper4br <- round(hardships_jh_r_moe[, 4]$conf.upper/100, 2)

lower5br <- round(hardships_jh_r_moe[, 5]$conf.lower/100, 2)
upper5br <- round(hardships_jh_r_moe[, 5]$conf.upper/100, 2)

lower6br <- round(hardships_jh_r_moe[, 6]$conf.lower/100, 2)
upper6br <- round(hardships_jh_r_moe[, 6]$conf.upper/100, 2)

lower7br <- round(hardships_jh_r_moe[, 7]$conf.lower/100, 2)
upper7br <- round(hardships_jh_r_moe[, 7]$conf.upper/100, 2)

lower8br <- round(hardships_jh_r_moe[, 8]$conf.lower/100, 2)
upper8br <- round(hardships_jh_r_moe[, 8]$conf.upper/100, 2)

lower9br <- round(hardships_jh_r_moe[, 9]$conf.lower/100, 2)
upper9br <- round(hardships_jh_r_moe[, 9]$conf.upper/100, 2)

lower10br <- round(hardships_jh_r_moe[, 10]$conf.lower/100, 2)
upper10br <- round(hardships_jh_r_moe[, 10]$conf.upper/100, 2)

lower11br <- round(hardships_jh_r_moe[, 11]$conf.lower/100, 2)
upper11br <- round(hardships_jh_r_moe[, 11]$conf.upper/100, 2)

lower12br <- round(hardships_jh_r_moe[, 12]$conf.lower/100, 2)
upper12br <- round(hardships_jh_r_moe[, 12]$conf.upper/100, 2)

lower13br <- round(hardships_jh_r_moe[, 13]$conf.lower/100, 2)
upper13br <- round(hardships_jh_r_moe[, 13]$conf.upper/100, 2)

lower14br <- round(hardships_jh_r_moe[, 14]$conf.lower/100, 2)
upper14br <- round(hardships_jh_r_moe[, 14]$conf.upper/100, 2)

lower15br <- round(hardships_jh_r_moe[, 15]$conf.lower/100, 2)
upper15br <- round(hardships_jh_r_moe[, 15]$conf.upper/100, 2)

lower16br <- round(hardships_jh_r_moe[, 16]$conf.lower/100, 2)
upper16br <- round(hardships_jh_r_moe[, 16]$conf.upper/100, 2)

lower17br <- round(hardships_jh_r_moe[, 17]$conf.lower/100, 2)
upper17br <- round(hardships_jh_r_moe[, 17]$conf.upper/100, 2)

lower18br <- round(hardships_jh_r_moe[, 18]$conf.lower/100, 2)
upper18br <- round(hardships_jh_r_moe[, 18]$conf.upper/100, 2)
```

```{r plot_figure_2, message=FALSE, warning=FALSE}
fig5
```
<p>&nbsp;</p>
<p align="justify">
Figure 3 further breaks down the three most prevalent material hardships by race and ethnicity and by neighborhood. The racial and ethnic disparities in material hardships parallel the racial disparities in job loss. Regardless of neighborhood type, Hispanic households are the most disadvantaged, with roughly half of them experiencing hardships in mortgage/rent payment, affording food, and paying utility bills. Paralleling the patterns in Figure 1, non-Hispanic Others—many of whom did not experience job loss—are the group that is least impacted by material hardships. With regard to the disparities in material hardships by neighborhood, Figure 3 reveals some substantial differences in the material hardship prevalence between the two neighborhoods. For example, about 3% of non-Hispanic Others had difficulty making rent or mortgage payments in Elm Creek, while a non-trivial percentage (12.5%) of non-Hispanic Others in Jefferson Heights experienced this hardship. A more striking disparity exists in hardship of paying utility bill among Whites. While 26% of Whites in Elm Creek reported having trouble paying utility bills, more than 40% of Whites in Jefferson Heights experienced this type of hardship. This disparity might be driven by significant gaps in the age of housing stock and the availability of energy saving technologies in the advantaged and disadvantaged neighborhoods. 
</p>
<p>&nbsp;</p>
<center>**Figure 3.** The Most Prevalent Material Hardship Types, by Race/Ethnicity and by Neighborhood</center>  
```{r plot_figure_3, message=FALSE, warning=FALSE}
# facet names
hardships_lbl <- c("Job loss", "Paying utility bills", "Affording food", "Paying rent/mortgage", 
                   "Paying medical bills", "Delay medical care")
names(hardships_lbl) <- c("Job loss", "Paying utility bills", "Affording food", "Paying rent/mortgage", 
                   "Paying medical bills", "Delay getting medical care")

hardships.r <- hardships.r %>% filter(hardships != "No difficulty") %>%  arrange(zipcode)

hardships.r$lower <- c(lower1r, lower2r, lower3r, lower4r, lower5r, lower6r, lower7r, lower8r, lower9r, lower10r,
                       lower11r, lower12r, lower13r, lower14r, lower15r, lower16r, lower17r, lower18r, 
                       lower1br, lower2br, lower3br, lower4br, lower5br, lower6br, lower7br, lower8br, lower9br, lower10br,
                       lower11br, lower12br, lower13br, lower14br, lower15br, lower16br, lower17br, lower18br)
hardships.r$upper <- c(upper1r, upper2r, upper3r, upper4r, upper5r, upper6r, upper7r, upper8r, upper9r, upper10r,
                       upper11r, upper12r, upper13r, upper14r, upper15r, upper16r, upper17r, upper18r,
                       upper1br, upper2br, upper3br, upper4br, upper5br, upper6br, upper7br, upper8br, upper9br, upper10br,
                       upper11br, upper12br, upper13br, upper14br, upper15br, upper16br, upper17br, upper18br)

hardships.r %>% 
  filter(hardships != "No difficulty", 
         (hardships == "Affording food" | hardships == "Paying rent/mortgage" | hardships == "Paying utility bills"))%>% 
  ggplot(aes(x = pct, y = reorder(race_eth3, pct), color = zipcode)) +
  geom_errorbar(aes(xmin = lower, xmax = upper), show.legend = F, width = 0.1) +
  geom_point(stat = "identity", aes(size = n)) +
  geom_text_repel(aes(label = lbl), size = 8, color = "gray10", segment.alpha = 0, family = "foo", nudge_y = .2, nudge_x = .025) +
  scale_x_continuous(limits = c(0, .6), breaks = seq(0, 1, .2), label = scales::percent) +
  scale_color_manual(values = wes_palette("Darjeeling2", n = 3)) +
  guides(color = guide_legend(label.position = "left", label.vjust = 0.5, label.hjust = 1, override.aes = list(size = 5)), 
         size = F) +
  facet_grid(~factor(hardships, levels = c("Paying rent/mortgage", "Affording food", "Paying utility bills")),
             labeller = labeller(hardships = hardships_lbl), shrink = T, scales = "free") +
  labs(y = NULL, x = NULL, color = NULL,
       title = NULL, 
       subtitle = NULL,
       caption = NULL) +
  theme_minimal() +
  themeuf + theme(legend.position = "bottom", strip.text = element_text(size = 25), 
                  axis.text.x = element_text(size = 20, color = "gray10", face = "bold"))

ggsave(filename = "figure_3_new.png", plot = last_plot(), path = "~/GitHub/saetus/", width = 7, height = 4.5, units = "in", dpi = "print")

# data %>%
#   filter(!is.na(bad)) %>% 
#   group_by(zipcode, bad, race_eth3) %>%
#   summarize(n = n()) %>% 
#   mutate(pct = n/sum(n),
#          lbl = scales::percent(pct, accuracy = 0.1)) %>% 
#   ggplot(aes(x = pct, y = reorder(race_eth3, pct), color = zipcode)) +
#   geom_point(aes(size = n)) +
#   geom_text_repel(aes(label = lbl), size = 5, color = "gray30", segment.alpha = 0, family = "foo", nudge_y = .2, nudge_x = .01) +
#   scale_x_continuous(limits = c(0, .75), breaks = seq(0, 1, .15), label = scales::percent) +
#   scale_color_manual(values = wes_palette("Darjeeling2", n = 3)) +
#   guides(color = guide_legend(label.position = "left", label.vjust = 0.5, label.hjust = 1, override.aes = list(size = 5)), 
#          size = F) +
#   facet_grid(~bad, scales = "free") +
#   labs(y = NULL, x = NULL, color = NULL,
#        title = "Number of hardships by zip code", 
#        subtitle = str_wrap("Since the onset of COVID-19 (March 2020), have you, or has anyone in your household experienced any type of hardships"),
#        caption = "Source: 2021 San Antonio Energy and Time Use Survey") +
#   theme_classic() +
#   themeuf + theme(axis.text.x = element_text(color = "gray40", size = 18))
```
<p>&nbsp;</p>
**3) Initial Evidence on Stalled Employment Recovery**
<p align="justify">
*The prevalence of stalled job recovery varies somewhat by racial/ethnic groups and by neighborhood. In particular, non-Hispanic Others in Jefferson Heights experienced a much stalled recovery relative to their counterparts in Elm Creek.* 
</p>

<p align="justify">
Our survey research was conducted roughly a year since the pandemic started. Early signs of economic recovery emerged at the time we collected our survey data in late March 2021. Although the full employment recovery path is still unclear at the local and national level, our community survey provides a first glimpse of the intricate details about the unequal employment recovery by racial and ethnic background and by neighborhood context. To gauge initial evidence of stalled employment recovery from the COVID-19 pandemic, we use the survey question asking respondent’s employment status. Those who reported income loss since the onset of the pandemic and those who are still out of the labor force (i.e., being laid off, temporarily out of the labor market, or actively looking for a job) at the time of the survey are considered having stalled employment recovery. Individuals who are retired or permanently out of the labor market (due to disability, for example) are excluded from the analysis.  
</p>

<p align="justify">
Figure 4 shows the percentage of respondents who experience stalled employment recovery at the time of the survey by race and ethnicity and by neighborhood. Regardless of neighborhood, Hispanics outperform other racial/ethnic groups in employment recovery, as indicated by only 4.6% and 11% of Hispanics in Jefferson Heights and Elm Creek have not recovered their employment, respectively. Although Hispanics were hit disproportionately hard by the pandemic, they are also the ones that first recovered. It could be due to the quick recovery of the employment sectors in which Hispanics tend to work, such as the leisure and hospitality sectors, education, and health services.  Minority members, on the other hand, who left the workforce at the lowest rate also see the least initial employment recovery.
</p>
<p>&nbsp;</p>
<center>**Figure 4.** Percentage of respondents who have not recovered their job by race and ethnicity and by neighborhood</center>
```{r fig4, include=FALSE}
# mydata <- data
# 
# mydata$emp_status_partner2 <- if_else(mydata$emp_status_partner %in% c("Work for pay at a job", "Temporarily absent from job"), "employed",
#                                       if_else(mydata$emp_status_partner %in% c("Layoff from a job", "Actively looking for a job"), "unemployed",
#                                               if_else(mydata$emp_status_partner %in% c("Retired", "Unable to work"), "retired", "NA")))

######################################################
### make emp_status2 variable treating Temporarily ###
### absent from job as a job recovery event        ###
######################################################
# mydata <- mydata %>%
#   mutate(emp_status2 = if_else(emp_status %in% c("Work for pay at a job"), "employed",
#                                 if_else(emp_status %in% c("Temporarily absent from job", "Layoff from a job", "Actively looking for a job"), "Unrecovery",
#                                         if_else(emp_status %in% c("Retired", "Unable to work"),"retired","NA"))))
#mydata <- mydata %>%
#  mutate_at(vars(emp_status), ~ if_else(. %in% c("Work for pay at a job","Temporarily absent from job"), "employed",
#                                       if_else(. %in% c("Layoff from a job","Actively looking for a job"), "unemployed",
#                                               if_else(. %in% c("Retired", "Unable to work"), "retired", "NA"))))

# mydata$emp_status_partner3 <- if_else(mydata$emp_status_partner %in% c("Work for pay at a job"), "employed",
#                                       if_else(mydata$emp_status_partner %in% c("Temporarily absent from job", "Layoff from a job", "Actively looking for a job"), "Unrecovery",
#                                       if_else(mydata$emp_status %in% c("Retired", "Unable to work"),"retired","NA")))

#################################
### Total Target Respondents  ###
#################################
# n_recover <- NULL
# mydata <- mydata[which(mydata$emp_status2 != "retired" & mydata$emp_status2 != "NA" & mydata$emp_status_partner2 != "retired" & mydata$emp_status_partner2 != "NA"),]
# total <- mydata[which(mydata$hardships_1 == 1),]
############
### plot ###
############
# n_recover <- total %>% 
#   group_by(zipcode, race_eth3) %>% 
#   summarize(n = n())
# n_recover <- data.frame(n_recover)
# colnames(n_recover) <- c("Zipcode","Race","Total")
#################
### unrecover ###
#################
# unrecover <- total[which(total$emp_status2 == "Unrecovery" & total$emp_status_partner3 == "Unrecovery"),]
# unrecover <- unrecover %>% 
#   group_by(zipcode, race_eth3) %>% 
#   summarize(n = n())
# unrecover <- data.frame(unrecover)
# colnames(unrecover) <- c("Zipcode","Race","Unrecover")
# n_recover <- cbind(n_recover,unrecover$Unrecover)
# colnames(n_recover) <- c("Zipcode","Race","Total","Unrecover")
###########
### pct ###
###########
# n_recover <- n_recover %>%
#   mutate(pct = Unrecover/Total,
#          lbl = scales::percent(pct, accuracy = 0.1))
# n_recover$lower = n_recover$pct - 1.645*(n_recover$pct * (1 - n_recover$pct)/n_recover$Total)^0.5
# n_recover$upper = n_recover$pct + 1.645*(n_recover$pct * (1 - n_recover$pct)/n_recover$Total)^0.5
# n_recover$Race2 <- ordered(n_recover$Race, 
#                            levels = c("Hispanic","Non-Hispanic White","Non-Hispanic Other"))


data_recovery <- data.frame(Zipcode = c(rep("Elm Creek", 3), rep("Jefferson Heights", 3)),
                            Race = c("Hispanic","Non-Hispanic White","Non-Hispanic Other", 
                                     "Hispanic","Non-Hispanic White","Non-Hispanic Other"),
                            Total = c(120,  91,  36,  79,  68,  15),
                            pct = c(0.110, 0.105, 0.071, 0.046, 0.205, 0.400))

data_recovery <- data_recovery %>%
  mutate(lbl = scales::percent(pct, accuracy = 0.1),
         lower = pct - 1.645*(pct * (1 - pct)/Total)^0.5,
         upper = pct + 1.645*(pct * (1 - pct)/Total)^0.5)

data_recovery$Race <- ordered(data_recovery$Race, levels = c("Hispanic","Non-Hispanic White","Non-Hispanic Other"))

fig4 <- data_recovery %>%
  ggplot(aes(x = pct, y = reorder(Race,-pct), color = Zipcode)) + 
  geom_errorbar(aes(xmin = lower, xmax = upper), show.legend = F, width = 0.15) +
  geom_point(aes(size = Total)) +
  geom_text_repel(aes(label = lbl), size = 8, color = "gray10", segment.alpha = 0, family = "foo", nudge_y = .3, nudge_x = .01) +
  scale_x_continuous(limits = c(0, .65), breaks = seq(0, 1, .15), label = scales::percent) +
  #scale_y_discrete(limits = levels(n_recover$Race))+
  scale_color_manual(values = wes_palette("Darjeeling2", n = 3)) +
  guides(color = guide_legend(label.position = "left", label.vjust = 0.5, label.hjust = 1, override.aes = list(size = 5)),
         size = F) +
  labs(y = NULL, x = NULL, color = NULL,
       title = NULL) +
  theme_classic() +
  themeuf +
  theme(legend.position = "bottom")
```

```{r plot_fig4, message=FALSE, warning=FALSE}
fig4
```
<p>&nbsp;</p>
##### **Lessons from the San Antonio Energy and Time Use Survey**
<p align="justify">
The disproportionate social and economic impacts in Texas and elsewhere following COVID-19 reflect harsh, longstanding inequalities in employment, material hardship, and other spheres of social life. The Household Pulse Survey  shows in June 2020 that 51.1% of the US residents and 53.5% of Texans lost their jobs. Our survey conducted in March 2021 suggests that about 65.5% of the respondents in Elm Creek and 65.8% of the respondents in Jefferson Heights lost their jobs. Perhaps partially reflecting the demographic composition of the study sites, as many as half of Hispanics who participated in the survey reported losing their job since the onset of COVID-19 (48.6% in Jefferson Heights and 48.5% in Elm Creek).  In addition, our local survey data analysis also indicates that residents of economically less favored neighborhoods, such as Jefferson Heights, experienced stalled employment recovery to a greater extent than their counterparts living in economically more favored neighborhoods like Elm Creek.  
</p>

<p align="justify">
As attention begins to turn to COVID-19 recovery, it is critically important to remember that residents in neighborhoods were impacted – and continue to be impacted – differently. These disparities will shape the trajectory and speed of their recovery for better or worse. Beyond the obvious measures of socioeconomic status that may contribute to faster recovery, social capital (resources available to people through their social networks) is also associated with recovery through several mechanisms.  Economic recovery efforts in San Antonio should keep the “social infrastructure” of neighborhoods in mind when planning. Given that racial minorities (particularly non-Hispanic blacks) in disadvantaged neighborhoods are being left behind in the employment recovery, local efforts are needed to build “social safety nets” that can provide financial and physical assistance, as well as other channels that connect them to job training and employment opportunities.  
</p>

<p align="justify">
Additionally, we suggest that recovery efforts should also seek – wherever possible – to narrowing existing disparities in housing, social capital, access to healthcare, and other factors that collectively contribute to social vulnerability.  Our policy brief presents evidence on the alarming racial disparities in economic hardships and stalled employment recovery during the pandemic. It is worth noting that not only racial disparities in other socioeconomic dimensions exist, they are persistent over time and exacerbated during the pandemic. It is the intersections of these dimensions that make communities and their residents vulnerable to catastrophes; mending them now can help ensure that these neighborhoods and the residents in these communities do not unjustly bear the brunt of future disasters.  
</p>
<p>&nbsp;</p>
##### **Conclusion**
<p align="justify">
The ongoing pandemic demands detailed and timely data, and the San Antonio Energy and Time Use Survey is an important tool that can help our community assess the impact of COVID-19 on households as the pandemic evolves and as the recovery unfolds. Because of the high rate of job loss, job recovery must be a key element in the design of upcoming labor policies. This will be especially relevant for the Black or other minority members, and particularly those living in disadvantaged neighborhoods like Jefferson Heights.
</p>
<p>&nbsp;</p>
##### **Acknowledgments**
<p align="justify">
We thank the San Antonio residents who participated in our survey. We also thank Barbara Ankamah and her team at the City of San Antonio’s Neighborhood Engagement Team for assistance with participant recruitment. All viewpoints in this work are ours alone and do not represent IDSER. Any errors are ours alone as well. This research was funded (full or in part) by The University of Texas at San Antonio, Office of the Vice President for Research, Economic Development, and Knowledge Enterprise.  
</p>
<p>&nbsp;</p>
##### **Notes**
<p align="justify">
^1^ On March 13th, 2020, San Antonio city officials confirmed the first two cases of COVID-19 unrelated to evacuees at Joint Base San Antonio-Lackland. See details in https://www.expressnews.com/business/health-care/article/San-Antonio-hospitals-prepare-for-worst-case-15131754.php

^2^ According to the latest Employment Situation Summary of the U.S. Bureau of Labor Statistics, unemployment rate was at 6.1% in April 2021, while in February 2020 it was 3.5%. See details in https://www.bls.gov/news.release/empsit.nr0.html

^3^ US Census Bureau. See details in https://www.census.gov/library/stories/2021/03/putting-economic-impact-of-pandemic-in-context.html

^4^ Child Trends. See details in https://www.childtrends.org/publications/more-than-one-in-four-latino-and-black-households-with-children-are-experiencing-three-or-more-hardships-during-covid-19

^5^ Center on Budget and Policy Priorities. See details in https://www.cbpp.org/research/poverty-and-inequality/tracking-the-covid-19-recessions-effects-on-food-housing-and

^6^ U.S. Census Bureau, 2015-2019 American Community Survey 5-Year Estimates.

^7^ Qualtrics survey software was launched in 2002 as a way for users to carry out research that previously, online survey tools had been unable to handle because of the complex needs of academic research. See details in https://www.qualtrics.com/core-xm/survey-software/

^8^ Unemployment rate in San Antonio-New Braunfels MSA decreases to 5.3 percent. Workforce Solutions Alamo releases May 2021 job market information. 

^9^ Measuring Household Experiences during the Coronavirus Pandemic. Interactive tool. See details in https://www.census.gov/data-tools/demo/hhp/#/

^10^ Aldrich, Daniel P. (2011). The power of people: social capital’s role in recovery from the 1995 Kobe earthquake. Nat Hazards 56:595-611.

^11^ Finch, Christina, Emrich, Christopher T, Cutter, Susan L. (2010). Disaster disparities and differential recovery in New Orleans. Popul Environ 31:179-202.
</p>












