ggplot(aes(x = poorh, y = race_eth)) +
geom_line(color = "gray50", size = 1) +
geom_point(aes(fill = as.factor(gender), color = as.factor(gender)), size = 4, shape = 19) +
facet_grid(~zip) +
geom_text(aes(label = label, x = poorh), nudge_y = 0.25, size = 3) +
geom_text(aes(label = gender, x = poorh), nudge_y = -0.25, size = 3) +
scale_color_brewer(type = "qual", palette = "Dark2") +
scale_fill_brewer(type = "qual") +
labs(title = "Days of poor health | Women and Men by race and ethnicity",
subtitle = "Average number of days with poor physical or mental health in January 2021",
x = NULL, y = NULL,
caption = "Source: 2021 San Antonio Energy and Time Use Survey") +
theme_linedraw() +
theme(plot.title = element_text(size = 12), plot.subtitle = element_text(size = 11),
legend.position = "none", legend.title = element_blank(),
axis.title = element_text(size = 10),
axis.text = element_text(size = 10),
axis.text.y = element_text(size = 10, color = "black"),
plot.caption = element_text(size = 8), panel.grid = element_blank(),
strip.background = element_rect(fill = NULL, linetype = "solid"),
strip.text = element_text(color = "white", size = 10))
san %>%
group_by(race_eth, zip, gender) %>%
dplyr::summarise(poorh = round(mean(as.numeric(days_poor_health), na.rm = T),1)) %>%
ungroup() %>%
select(race_eth, zip, gender, poorh) %>%
filter(gender != "Other", race_eth!= "NH-Other") %>%
mutate(label = poorh) %>%
ggplot(aes(x = poorh, y = race_eth)) +
geom_line(color = "gray50", size = 1) +
geom_point(aes(fill = as.factor(gender), color = as.factor(gender)), size = 4, shape = 19) +
facet_grid(~zip) +
geom_text(aes(label = label, x = poorh), nudge_y = 0.25, size = 3) +
geom_text(aes(label = gender, x = poorh), nudge_y = -0.25, size = 3) +
scale_color_brewer(type = "qual", palette = "Dark2") +
scale_fill_brewer(type = "qual") +
labs(title = "Days of poor health | Women and Men by race and ethnicity",
subtitle = "Average number of days with poor physical or mental health in January 2021",
x = NULL, y = NULL,
caption = "Source: 2021 San Antonio Energy and Time Use Survey") +
theme_linedraw() +
theme(plot.title = element_text(size = 12), plot.subtitle = element_text(size = 11),
legend.position = "none", legend.title = element_blank(),
axis.title = element_text(size = 10),
axis.text = element_text(size = 10),
axis.text.y = element_text(size = 10, color = "black"),
plot.caption = element_text(size = 8), panel.grid = element_blank(),
strip.background = element_rect(fill = NULL, linetype = "solid"),
strip.text = element_text(color = "white", size = 10))
san %>%
group_by(educ, zip, gender) %>%
dplyr::summarise(poorh = round(mean(as.numeric(days_poor_health), na.rm = T),1)) %>%
ungroup() %>%
select(educ, zip, gender, poorh) %>%
filter(gender != "Other", educ != "NA") %>%
mutate(label = poorh) %>%
ggplot(aes(x = poorh, y = educ)) +
geom_line(color = "gray50", size = 1) +
geom_point(aes(fill = as.factor(gender), color = as.factor(gender)), size = 4, shape = 19) +
facet_grid(~zip) +
geom_text(aes(label = label, x = poorh), nudge_y = 0.25, size = 3) +
geom_text(aes(label = gender, x = poorh), nudge_y = -0.25, size = 3) +
scale_color_brewer(type = "qual", palette = "Dark2") +
scale_fill_brewer(type = "qual") +
labs(title = "Days of poor health | Women and Men by education level",
subtitle = "Average number of days with poor physical or mental health in January 2021",
x = NULL, y = NULL,
caption = "Source: 2021 San Antonio Energy and Time Use Survey") +
theme_linedraw() +
theme(plot.title = element_text(size = 12), plot.subtitle = element_text(size = 11),
legend.position = "none", legend.title = element_blank(),
axis.title = element_text(size = 10),
axis.text = element_text(size = 10),
axis.text.y = element_text(size = 10, color = "black"),
plot.caption = element_text(size = 8), panel.grid = element_blank(),
strip.background = element_rect(fill = NULL, linetype = "solid"),
strip.text = element_text(color = "white", size = 10))
san %>%
group_by(front, zip, gender) %>%
dplyr::summarise(poorh = round(mean(as.numeric(days_poor_health), na.rm = T),1)) %>%
ungroup() %>%
select(front, zip, gender, poorh) %>%
filter(gender != "Other", front != "NA") %>%
mutate(label = poorh) %>%
ggplot(aes(x = poorh, y = front)) +
geom_line(color = "gray50", size = 1) +
geom_point(aes(fill = as.factor(gender), color = as.factor(gender)), size = 4, shape = 19) +
facet_grid(~zip) +
geom_text(aes(label = label, x = poorh), nudge_y = 0.25, size = 3) +
geom_text(aes(label = gender, x = poorh), nudge_y = -0.25, size = 3) +
scale_color_brewer(type = "qual", palette = "Dark2") +
scale_fill_brewer(type = "qual") +
labs(title = "Days of poor health | Women and Men by frontline worker status",
subtitle = "Average number of days with poor physical or mental health in January 2021",
x = NULL, y = NULL,
caption = "Source: 2021 San Antonio Energy and Time Use Survey") +
theme_linedraw() +
theme(plot.title = element_text(size = 12), plot.subtitle = element_text(size = 11),
legend.position = "none", legend.title = element_blank(),
axis.title = element_text(size = 10),
axis.text = element_text(size = 10),
axis.text.y = element_text(size = 10, color = "black"),
plot.caption = element_text(size = 8), panel.grid = element_blank(),
strip.background = element_rect(fill = NULL, linetype = "solid"),
strip.text = element_text(color = "white", size = 10))
san %>%
group_by(race_eth, zip, gender) %>%
dplyr::summarise(poorh = round(mean(as.numeric(days_poor_health), na.rm = T),1)) %>%
ungroup() %>%
select(race_eth, zip, gender, poorh) %>%
filter(gender != "Other", race_eth!= "NH-Other") %>%
mutate(label = poorh) %>%
ggplot(aes(x = poorh, y = race_eth)) +
geom_line(color = "gray50", size = 1) +
geom_point(aes(fill = as.factor(gender), color = as.factor(gender)), size = 4, shape = 19) +
facet_grid(~zip) +
geom_text(aes(label = label, x = poorh), nudge_y = 0.25, size = 3) +
geom_text(aes(label = gender, x = poorh), nudge_y = -0.25, size = 3) +
scale_color_brewer(type = "qual", palette = "Dark2") +
scale_fill_brewer(type = "qual") +
labs(title = "Days of poor health | Women and Men by race and ethnicity",
subtitle = "Average number of days with poor physical or mental health in January 2021",
x = NULL, y = NULL,
caption = "Source: 2021 San Antonio Energy and Time Use Survey") +
theme_linedraw() +
theme(plot.title = element_text(size = 12), plot.subtitle = element_text(size = 11),
legend.position = "none", legend.title = element_blank(),
axis.title = element_text(size = 10),
axis.text = element_text(size = 10),
axis.text.y = element_text(size = 10, color = "black"),
plot.caption = element_text(size = 8), panel.grid = element_blank(),
strip.background = element_rect(fill = NULL, linetype = "solid"),
strip.text = element_text(color = "white", size = 10))
san %>%
group_by(educ, zip, gender) %>%
dplyr::summarise(poorh = round(mean(as.numeric(days_poor_health), na.rm = T),1)) %>%
ungroup() %>%
select(educ, zip, gender, poorh) %>%
filter(gender != "Other", educ != "NA") %>%
mutate(label = poorh) %>%
ggplot(aes(x = poorh, y = educ)) +
geom_line(color = "gray50", size = 1) +
geom_point(aes(fill = as.factor(gender), color = as.factor(gender)), size = 4, shape = 19) +
facet_grid(~zip) +
geom_text(aes(label = label, x = poorh), nudge_y = 0.25, size = 3) +
geom_text(aes(label = gender, x = poorh), nudge_y = -0.25, size = 3) +
scale_color_brewer(type = "qual", palette = "Dark2") +
scale_fill_brewer(type = "qual") +
labs(title = "Days of poor health | Women and Men by education level",
subtitle = "Average number of days with poor physical or mental health in January 2021",
x = NULL, y = NULL,
caption = "Source: 2021 San Antonio Energy and Time Use Survey") +
theme_linedraw() +
theme(plot.title = element_text(size = 12), plot.subtitle = element_text(size = 11),
legend.position = "none", legend.title = element_blank(),
axis.title = element_text(size = 10),
axis.text = element_text(size = 10),
axis.text.y = element_text(size = 10, color = "black"),
plot.caption = element_text(size = 8), panel.grid = element_blank(),
strip.background = element_rect(fill = NULL, linetype = "solid"),
strip.text = element_text(color = "white", size = 10))
san %>%
group_by(front, zip, gender) %>%
dplyr::summarise(poorh = round(mean(as.numeric(days_poor_health), na.rm = T),1)) %>%
ungroup() %>%
select(front, zip, gender, poorh) %>%
filter(gender != "Other", front != "NA") %>%
mutate(label = poorh) %>%
ggplot(aes(x = poorh, y = front)) +
geom_line(color = "gray50", size = 1) +
geom_point(aes(fill = as.factor(gender), color = as.factor(gender)), size = 4, shape = 19) +
facet_grid(~zip) +
geom_text(aes(label = label, x = poorh), nudge_y = 0.25, size = 3) +
geom_text(aes(label = gender, x = poorh), nudge_y = -0.25, size = 3) +
scale_color_brewer(type = "qual", palette = "Dark2") +
scale_fill_brewer(type = "qual") +
labs(title = "Days of poor health | Women and Men by frontline worker status",
subtitle = "Average number of days with poor physical or mental health in January 2021",
x = NULL, y = NULL,
caption = "Source: 2021 San Antonio Energy and Time Use Survey") +
theme_linedraw() +
theme(plot.title = element_text(size = 12), plot.subtitle = element_text(size = 11),
legend.position = "none", legend.title = element_blank(),
axis.title = element_text(size = 10),
axis.text = element_text(size = 10),
axis.text.y = element_text(size = 10, color = "black"),
plot.caption = element_text(size = 8), panel.grid = element_blank(),
strip.background = element_rect(fill = NULL, linetype = "solid"),
strip.text = element_text(color = "white", size = 10))
san %>%
group_by(race_eth, zip, gender) %>%
dplyr::summarise(poorh = round(mean(as.numeric(days_poor_health), na.rm = T), 1)) %>%
ungroup() %>%
select(race_eth, zip, gender, poorh) %>%
filter(gender != "Other", race_eth!= "NH-Other") %>%
mutate(label = poorh) %>%
ggplot(aes(x = poorh, y = race_eth)) +
geom_line(color = "gray50", size = 1) +
geom_point(aes(fill = as.factor(gender), color = as.factor(gender)), size = 4, shape = 19) +
facet_grid(~zip) +
geom_text(aes(label = label, x = poorh), nudge_y = 0.25, size = 5) +
geom_text(aes(label = gender, x = poorh), nudge_y = -0.25, size = 5) +
scale_color_brewer(type = "qual", palette = "Dark2") +
scale_fill_brewer(type = "qual") +
labs(title = "Days of poor health | Women and Men by race and ethnicity",
x = "Average number of days with poor physical or mental health in January 2021",
y = NULL,
caption = "Source: 2021 San Antonio Energy and Time Use Survey") +
theme_linedraw() +
theme(plot.title = element_text(size = 12), plot.subtitle = element_text(size = 11),
legend.position = "none", legend.title = element_blank(),
axis.title = element_text(size = 10),
axis.text = element_text(size = 10),
axis.text.y = element_text(size = 10, color = "black"),
plot.caption = element_text(size = 8), panel.grid = element_blank(),
strip.background = element_rect(fill = NULL, linetype = "solid"),
strip.text = element_text(color = "white", size = 10))
san %>%
group_by(educ, zip, gender) %>%
dplyr::summarise(poorh = round(mean(as.numeric(days_poor_health), na.rm = T), 1)) %>%
ungroup() %>%
select(educ, zip, gender, poorh) %>%
filter(gender != "Other", educ != "NA") %>%
mutate(label = poorh) %>%
ggplot(aes(x = poorh, y = educ)) +
geom_line(color = "gray50", size = 1) +
geom_point(aes(fill = as.factor(gender), color = as.factor(gender)), size = 4, shape = 19) +
facet_grid(~zip) +
geom_text(aes(label = label, x = poorh), nudge_y = 0.25, size = 6) +
geom_text(aes(label = gender, x = poorh), nudge_y = -0.25, size = 6 +
scale_color_brewer(type = "qual", palette = "Dark2") +
scale_fill_brewer(type = "qual") +
labs(title = "Days of poor health | Women and Men by education level",
x = "Average number of days with poor physical or mental health in January 2021",
y = NULL,
caption = "Source: 2021 San Antonio Energy and Time Use Survey") +
theme_linedraw() +
theme(plot.title = element_text(size = 16, face = "bold"), plot.subtitle = element_text(size = 11),
legend.position = "none", legend.title = element_blank(),
axis.title = element_text(size = 12),
axis.text = element_text(size = 12),
axis.text.y = element_text(size = 12, color = "black"),
plot.caption = element_text(size = 9), panel.grid = element_blank(),
strip.background = element_rect(fill = NULL, linetype = "solid"),
strip.text = element_text(color = "white", size = 14))
san %>%
san %>%
group_by(educ, zip, gender) %>%
dplyr::summarise(poorh = round(mean(as.numeric(days_poor_health), na.rm = T), 1)) %>%
ungroup() %>%
select(educ, zip, gender, poorh) %>%
filter(gender != "Other", educ != "NA") %>%
mutate(label = poorh) %>%
ggplot(aes(x = poorh, y = educ)) +
geom_line(color = "gray50", size = 1) +
geom_point(aes(fill = as.factor(gender), color = as.factor(gender)), size = 4, shape = 19) +
facet_grid(~zip) +
geom_text(aes(label = label, x = poorh), nudge_y = 0.25, size = 6) +
geom_text(aes(label = gender, x = poorh), nudge_y = -0.25, size = 6) +
scale_color_brewer(type = "qual", palette = "Dark2") +
scale_fill_brewer(type = "qual") +
labs(title = "Days of poor health | Women and Men by education level",
x = "Average number of days with poor physical or mental health in January 2021",
y = NULL,
caption = "Source: 2021 San Antonio Energy and Time Use Survey") +
theme_linedraw() +
theme(plot.title = element_text(size = 16, face = "bold"), plot.subtitle = element_text(size = 11),
legend.position = "none", legend.title = element_blank(),
axis.title = element_text(size = 12),
axis.text = element_text(size = 12),
axis.text.y = element_text(size = 12, color = "black"),
plot.caption = element_text(size = 9), panel.grid = element_blank(),
strip.background = element_rect(fill = NULL, linetype = "solid"),
strip.text = element_text(color = "white", size = 14))
san %>%
group_by(front, zip, gender) %>%
dplyr::summarise(poorh = round(mean(as.numeric(days_poor_health), na.rm = T), 1)) %>%
ungroup() %>%
select(front, zip, gender, poorh) %>%
filter(gender != "Other", front != "NA") %>%
mutate(label = poorh) %>%
ggplot(aes(x = poorh, y = front)) +
geom_line(color = "gray50", size = 1) +
geom_point(aes(fill = as.factor(gender), color = as.factor(gender)), size = 4, shape = 19) +
facet_grid(~zip) +
geom_text(aes(label = label, x = poorh), nudge_y = 0.25, size = 3) +
geom_text(aes(label = gender, x = poorh), nudge_y = -0.25, size = 3) +
scale_color_brewer(type = "qual", palette = "Dark2") +
scale_fill_brewer(type = "qual") +
labs(title = "Days of poor health | Women and Men by frontline worker status",
x = "Average number of days with poor physical or mental health in January 2021",
y = NULL,
caption = "Source: 2021 San Antonio Energy and Time Use Survey") +
theme_linedraw() +
theme(plot.title = element_text(size = 12, face = "bold"), plot.subtitle = element_text(size = 11),
legend.position = "none", legend.title = element_blank(),
axis.title = element_text(size = 10),
axis.text = element_text(size = 10),
axis.text.y = element_text(size = 10, color = "black"),
plot.caption = element_text(size = 8), panel.grid = element_blank(),
strip.background = element_rect(fill = NULL, linetype = "solid"),
strip.text = element_text(color = "white", size = 10))
san %>%
group_by(educ, zip, gender) %>%
dplyr::summarise(poorh = round(mean(as.numeric(days_poor_health), na.rm = T), 1)) %>%
ungroup() %>%
select(educ, zip, gender, poorh) %>%
filter(gender != "Other", educ != "NA") %>%
mutate(label = poorh) %>%
ggplot(aes(x = poorh, y = educ)) +
geom_line(color = "gray50", size = 1) +
geom_point(aes(fill = as.factor(gender), color = as.factor(gender)), size = 4, shape = 19) +
facet_grid(~zip) +
geom_text(aes(label = label, x = poorh), nudge_y = 0.25, size = 5) +
geom_text(aes(label = gender, x = poorh), nudge_y = -0.25, size = 5) +
scale_color_brewer(type = "qual", palette = "Dark2") +
scale_fill_brewer(type = "qual") +
labs(title = "Days of poor health | Women and Men by education level",
x = "Average number of days with poor physical or mental health in January 2021",
y = NULL,
caption = "Source: 2021 San Antonio Energy and Time Use Survey") +
theme_linedraw() +
theme(plot.title = element_text(size = 20, face = "bold"), plot.subtitle = element_text(size = 11),
legend.position = "none", legend.title = element_blank(),
axis.title = element_text(size = 15),
axis.text = element_text(size = 15),
axis.text.y = element_text(size = 15, color = "black"),
plot.caption = element_text(size = 10), panel.grid = element_blank(),
strip.background = element_rect(fill = NULL, linetype = "solid"),
strip.text = element_text(color = "white", size = 14, face = "bold"))
themeu <- theme(plot.title = element_text(size = 16, face = "bold"),
plot.subtitle = element_text(size = 11),
legend.position = "none",
legend.title = element_blank(),
axis.title = element_text(size = 12),
axis.text = element_text(size = 12),
axis.text.y = element_text(size = 12, color = "black"),
plot.caption = element_text(size = 9),
panel.grid = element_blank(),
strip.background = element_rect(fill = NULL, linetype = "solid"),
strip.text = element_text(color = "white", size = 14))
themeu <- theme(plot.title = element_text(size = 22, face = "bold"),
plot.subtitle = element_text(size = 11),
legend.position = "none",
legend.title = element_blank(),
axis.title = element_text(size = 17),
axis.text = element_text(size = 17),
axis.text.y = element_text(size = 17, color = "black"),
plot.caption = element_text(size = 12),
panel.grid = element_blank(),
strip.background = element_rect(fill = NULL, linetype = "solid"),
strip.text = element_text(color = "white", size = 18, face = "bold"))
san %>%
group_by(race_eth, zip, gender) %>%
dplyr::summarise(poorh = round(mean(as.numeric(days_poor_health), na.rm = T), 1)) %>%
ungroup() %>%
select(race_eth, zip, gender, poorh) %>%
filter(gender != "Other", race_eth!= "NH-Other") %>%
mutate(label = poorh) %>%
ggplot(aes(x = poorh, y = race_eth)) +
geom_line(color = "gray50", size = 1) +
geom_point(aes(fill = as.factor(gender), color = as.factor(gender)), size = 4, shape = 19) +
facet_grid(~zip) +
geom_text(aes(label = label, x = poorh), nudge_y = 0.25, size = 4.5) +
geom_text(aes(label = gender, x = poorh), nudge_y = -0.25, size = 4.5) +
scale_color_brewer(type = "qual", palette = "Dark2") +
scale_fill_brewer(type = "qual") +
labs(title = "Days of poor health | Women and Men by race and ethnicity",
x = "Average number of days with poor physical or mental health in January 2021",
y = NULL,
caption = "Source: 2021 San Antonio Energy and Time Use Survey") +
theme_linedraw() +
themeu
san %>%
group_by(educ, zip, gender) %>%
dplyr::summarise(poorh = round(mean(as.numeric(days_poor_health), na.rm = T), 1)) %>%
ungroup() %>%
select(educ, zip, gender, poorh) %>%
filter(gender != "Other", educ != "NA") %>%
mutate(label = poorh) %>%
ggplot(aes(x = poorh, y = educ)) +
geom_line(color = "gray50", size = 1) +
geom_point(aes(fill = as.factor(gender), color = as.factor(gender)), size = 4, shape = 19) +
facet_grid(~zip) +
geom_text(aes(label = label, x = poorh), nudge_y = 0.25, size = 4.5) +
geom_text(aes(label = gender, x = poorh), nudge_y = -0.25, size = 4.5) +
scale_color_brewer(type = "qual", palette = "Dark2") +
scale_fill_brewer(type = "qual") +
labs(title = "Days of poor health | Women and Men by education level",
x = "Average number of days with poor physical or mental health in January 2021",
y = NULL,
caption = "Source: 2021 San Antonio Energy and Time Use Survey") +
theme_linedraw() +
themeu
san %>%
group_by(front, zip, gender) %>%
dplyr::summarise(poorh = round(mean(as.numeric(days_poor_health), na.rm = T), 1)) %>%
ungroup() %>%
select(front, zip, gender, poorh) %>%
filter(gender != "Other", front != "NA") %>%
mutate(label = poorh) %>%
ggplot(aes(x = poorh, y = front)) +
geom_line(color = "gray50", size = 1) +
geom_point(aes(fill = as.factor(gender), color = as.factor(gender)), size = 4, shape = 19) +
facet_grid(~zip) +
geom_text(aes(label = label, x = poorh), nudge_y = 0.25, size = 4.5) +
geom_text(aes(label = gender, x = poorh), nudge_y = -0.25, size = 4.5) +
scale_color_brewer(type = "qual", palette = "Dark2") +
scale_fill_brewer(type = "qual") +
labs(title = "Days of poor health | Women and Men by frontline worker status",
x = "Average number of days with poor physical or mental health in January 2021",
y = NULL,
caption = "Source: 2021 San Antonio Energy and Time Use Survey") +
theme_linedraw() +
themeu
View(san)
length$unique(san$LocationLatitude)
length(unique(san$LocationLatitude))
length(unique(san$IPAddress))
length(unique(san$LocationLatitude))
length(unique(san$LocationLongitude))
length(unique(san$LocationLatitude))
length(unique(san$LocationLongitude))
length(unique(san$ResponseId))
length(unique(san$email))
unique_emails <- unique(san$email)
write.csv(x = unique_emails, file = "~/GitHub/san/unique_emails.csv")
knitr::opts_chunk$set(echo = TRUE)
library(readxl)
library(dplyr)
library(ggplot2)
library(plotly)
library(patchwork)
library(showtext)
library(kableExtra)
library(summarytools)
library(gtsummary)
# From Qualtrics we get the data as .csv with default options: Recode seen but unanswered questions as -99. Recode seen but unanswered multi-value fields as 0.
# Change path
san <- read_excel("~/GitHub/saetus/San Antonio Energy and Time Use Survey (03.10).xlsx", col_names = T)
# delete responses before 22.02. These were responses from us. Delete some defaults columns, only have NA values.
san <- san[-c(1:9), - c(10:13)]
# 174 variables when uploaded.  175 after this point.
# disagree; other_major_imp; other_impairment_hsh; other_eip
san <- san %>%
# I'm subtracting the column (rewrite_email) since nobody answer the question
mutate(number_missing_value = rowSums(is.na(san))-1,
# 174 total possible responses
nas_pct = round((number_missing_value/174*100), 1))
### NAs
summary(san$number_missing_value)
### by Peter
san <- san %>%
mutate(duration = round(as.numeric(`Duration (in seconds)`)/60, 1),
upper_out = quantile(duration, probs = 0.975, na.rm = T),
upper_out2 = quantile(duration, probs = 0.95, na.rm = T),
lower_out = quantile(duration, probs = 0.025, na.rm = T),
lower_out2 = quantile(duration, probs = 0.05, na.rm = T),
na_low = quantile(nas_pct, probs = 0.10),
na_upp = quantile(nas_pct, probs = 0.90),
duration_min_out = if_else(duration <= lower_out, "Spend too little time",
if_else(duration >= upper_out, "Spend too much time", "Normal")),
duration_min_out2 = if_else(duration <= lower_out2, "Below 5% quantile",
if_else(duration >= upper_out2, "Above 95% quantile", "Normal")),
nas_out = if_else(nas_pct <= na_low, "Below 10% quantile",
if_else(nas_pct >= na_upp, "Above 90% quantile", "Normal")))
san$duration_min_out <- ordered(san$duration_min_out, levels = c("Spend too much time", "Normal", "Spend too little time"))
san$duration_min_out2 <- ordered(san$duration_min_out2, levels = c("Above 95% quantile", "Normal", "Below 5% quantile"))
san$nas_out <- ordered(san$nas_out, levels = c("Above 90% quantile", "Normal", "Below 10% quantile"))
san <- san %>%
mutate(odd_r = if_else(duration_min_out != "Normal" & nas_out == "Above 90% quantile", "Odd response", "Normal"),
odd_r2 = if_else(duration_min_out2 != "Normal" & nas_out == "Above 90% quantile", "Odd response", "Normal"))
### Duration and number of NAs
kable(table(san$nas_out, san$duration_min_out), caption = "NAs (%) vs Duration (min)") %>%
kable_classic(full_width = F) %>%
footnote(general = "NAs in (10%, 90%); duration in (2.5%, 97.5%)")
kable(table(san$nas_out, san$duration_min_out2), caption = "NAs (%) vs Duration (min)") %>%
kable_classic(full_width = F) %>%
footnote(general = "NAs in (10%, 90%); duration in (5%, 95%)")
kable(table(san$odd_r2), caption = "Odd responses") %>%
kable_classic(full_width = F)
sank <- san %>%
# consent Agree and double check on survey participation. Keep only zip codes 78202 or 78230. And keep only the first answer for unique emails
filter(consent == "1" | disagree == "1", zipcode != 3, odd_r2 == "Normal") %>%
mutate(zipcode = if_else(zipcode == "1", "Elm Creek",
if_else(zipcode == "2", "Jefferson Heights", NA_character_)),
rep_email = if_else(email == lag(email, n = 1, order_by = email), "rep_email", "first_entry")) %>%
filter(rep_email == "first_entry")
#view(dfSummary(sank[, 5:173], plain.ascii = F, graph.magnif = .75, labels.col = T, max.string.width = 15), method = "render")
sank %>%
select(146, 148:171, 175, 178:189) %>%
tbl_summary(by = zipcode,
statistic = list(all_continuous() ~ "{mean} ({sd})",
all_categorical() ~ "{n} ({p}%)"),
digits = list(all_continuous() ~ c(1, 1))) %>%
add_n() %>%
add_p() %>%
modify_header(label = "**variable**") %>%
modify_caption("**Section IV. Background characteristics (N = {N})**") %>%
bold_labels()
View(sank)
sank %>%
select(16, 121:143, 175, 178:189) %>%
tbl_summary(by = list(zipcode, duration_min_out),
statistic = list(all_continuous() ~ "{mean} ({sd})",
all_categorical() ~ "{n} ({p}%)"),
digits = list(all_continuous() ~ c(1, 1))) %>%
add_n() %>%
add_p() %>%
modify_header(label = "**variable**") %>%
modify_caption("**Section III. Employment (N = {N})**") %>%
bold_labels()
